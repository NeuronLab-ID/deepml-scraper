{
  "description": "SW1wbGVtZW50IEdyb3VwIFNlcXVlbmNlIFBvbGljeSBPcHRpbWl6YXRpb24gKEdTUE8pLCBhIHJlaW5mb3JjZW1lbnQgbGVhcm5pbmcgYWxnb3JpdGhtIGZvciB0cmFpbmluZyBsYXJnZSBsYW5ndWFnZSBtb2RlbHMuIFVubGlrZSB0b2tlbi1sZXZlbCBtZXRob2RzIGxpa2UgR1JQTyB0aGF0IHN1ZmZlciBmcm9tIHRyYWluaW5nIGluc3RhYmlsaXR5LCBHU1BPIHVzZXMgc2VxdWVuY2UtbGV2ZWwgaW1wb3J0YW5jZSByYXRpb3Mgd2l0aCBsZW5ndGggbm9ybWFsaXphdGlvbi4gR2l2ZW4gbG9nIHByb2JhYmlsaXRpZXMgZnJvbSBuZXcgYW5kIG9sZCBwb2xpY2llcyBhbG9uZyB3aXRoIHJld2FyZHMgZm9yIGEgZ3JvdXAgb2Ygc2VxdWVuY2VzLCBjb21wdXRlIHRoZSBjbGlwcGVkIG9iamVjdGl2ZS4gVGhlIGFsZ29yaXRobSBwcmV2ZW50cyBjYXRhc3Ryb3BoaWMgbW9kZWwgY29sbGFwc2UgYnkgYXBwbHlpbmcgY2xpcHBpbmcgYXQgdGhlIHNlcXVlbmNlIGxldmVsIHJhdGhlciB0aGFuIHRva2VuIGxldmVsLg==",
  "id": "209",
  "test_cases": [
    {
      "test": "import numpy as np; obj = gspo_objective([[0.0, -0.5, -1.0], [-0.3, -0.7]], [[0.0, -0.5, -1.0], [-0.3, -0.7]], [0.8, 0.6], epsilon=0.2); print(round(obj, 6))",
      "expected_output": "0.0"
    },
    {
      "test": "import numpy as np; obj = gspo_objective([[-0.2, -0.3], [-0.1, -0.4, -0.2]], [[-0.5, -0.6], [-0.4, -0.7, -0.5]], [0.9, 0.7], epsilon=0.2); print(round(obj, 6))",
      "expected_output": "-0.074929"
    }
  ],
  "difficulty": "hard",
  "video": "",
  "likes": "0",
  "dislikes": "0",
  "example": {
    "input": "log_probs_new=[[1.0, 0.5], [0.8, 1.2]], log_probs_old=[[0.0, 0.0], [0.0, 0.0]], rewards=[0.9, 0.7], epsilon=0.2",
    "output": "Approximately -0.089",
    "reasoning": "First compute advantages: mean=0.8, std=0.1, so A=[1.0, -1.0]. For seq 1: log ratio sum = 1.5, length = 2, so s_1 = exp(1.5/2) = 2.117, clipped to 1.2, objective = 1.2 × 1.0 = 1.2. For seq 2: log ratio sum = 2.0, length = 2, so s_2 = exp(2.0/2) = 2.718, clipped to 1.2, objective = 1.2 × (-1.0) = -1.2. Average = 0.0. The length normalization prevents extreme importance ratios."
  },
  "category": "Reinforcement Learning",
  "starter_code": "import numpy as np\n\ndef gspo_objective(log_probs_new: list[list[float]], \n                   log_probs_old: list[list[float]], \n                   rewards: list[float], \n                   epsilon: float = 0.2) -> float:\n\t\"\"\"\n\tCompute GSPO (Group Sequence Policy Optimization) clipped objective.\n\t\n\tArgs:\n\t\tlog_probs_new: Log probability sequences from new policy\n\t\tlog_probs_old: Log probability sequences from old policy\n\t\trewards: Reward for each sequence\n\t\tepsilon: Clipping range for importance ratios\n\t\n\tReturns:\n\t\tAverage clipped objective value\n\t\"\"\"\n\t# Your code here\n\tpass",
  "title": "GSPO: Group Sequence Policy Optimization",
  "createdAt": "November 18, 2025 at 12:12:33 PM UTC-0500",
  "contributor": [
    {
      "profile_link": "https://github.com/moe18",
      "name": "moe"
    }
  ],
  "learn_section": "IyMjIFVuZGVyc3RhbmRpbmcgR1NQTwoKR3JvdXAgU2VxdWVuY2UgUG9saWN5IE9wdGltaXphdGlvbiAoR1NQTykgaXMgYSBicmVha3Rocm91Z2ggcmVpbmZvcmNlbWVudCBsZWFybmluZyBhbGdvcml0aG0gZnJvbSBBbGliYWJhJ3MgUXdlbiB0ZWFtIHRoYXQgYWRkcmVzc2VzIGNyaXRpY2FsIHN0YWJpbGl0eSBpc3N1ZXMgaW4gdHJhaW5pbmcgbGFyZ2UgbGFuZ3VhZ2UgbW9kZWxzLiBJdCBwb3dlcnMgdGhlIGxhdGVzdCBRd2VuMyBtb2RlbHMgYW5kIHJlcHJlc2VudHMgYSBzaWduaWZpY2FudCBhZHZhbmNlbWVudCBvdmVyIHByZXZpb3VzIGFwcHJvYWNoZXMuCgojIyMjIFRoZSBQcm9ibGVtIHdpdGggVG9rZW4tTGV2ZWwgTWV0aG9kcwoKUHJldmlvdXMgYWxnb3JpdGhtcyBsaWtlIEdSUE8gKEdyb3VwIFJlbGF0aXZlIFBvbGljeSBPcHRpbWl6YXRpb24pIHVzZSB0b2tlbi1sZXZlbCBpbXBvcnRhbmNlIHJhdGlvczoKCiQkCndfe2ksdH0oXHRoZXRhKSA9IFxmcmFje1xwaV97XHRoZXRhfSh5X3tpLHR9fHgsIHlfe2ksPHR9KX17XHBpX3tcdGhldGFfe1x0ZXh0e29sZH19fSh5X3tpLHR9fHgsIHlfe2ksPHR9KX0KJCQKCioqQ3JpdGljYWwgZmxhdyoqOiBUaGlzIHJhdGlvIGlzIGJhc2VkIG9uIGEgc2luZ2xlIHNhbXBsZSAkeV97aSx0fSQgZnJvbSB0aGUgZGlzdHJpYnV0aW9uICRccGlfe1x0aGV0YV97XHRleHR7b2xkfX19KFxjZG90fHgsIHlfe2ksPHR9KSQsIHZpb2xhdGluZyB0aGUgZnVuZGFtZW50YWwgcHJpbmNpcGxlIG9mIGltcG9ydGFuY2Ugc2FtcGxpbmcuIEltcG9ydGFuY2Ugc2FtcGxpbmcgcmVxdWlyZXMgYXZlcmFnaW5nIG92ZXIgbXVsdGlwbGUgc2FtcGxlcyB0byBjb3JyZWN0IGRpc3RyaWJ1dGlvbmFsIG1pc21hdGNoOgoKJCQKXG1hdGhiYntFfV97elxzaW1ccGlfe1x0ZXh0e3Rhcn19fVtmKHopXSA9IFxtYXRoYmJ7RX1fe3pcc2ltXHBpX3tcdGV4dHtiZWh9fX1cbGVmdFtcZnJhY3tccGlfe1x0ZXh0e3Rhcn19KHopfXtccGlfe1x0ZXh0e2JlaH19KHopfSBmKHopXHJpZ2h0XQokJAoKV2l0aCBvbmx5IG9uZSBzYW1wbGUgcGVyIHRva2VuIHBvc2l0aW9uLCB0aGUgdG9rZW4tbGV2ZWwgd2VpZ2h0IGludHJvZHVjZXMgaGlnaC12YXJpYW5jZSBub2lzZSB0aGF0OgotIEFjY3VtdWxhdGVzIG92ZXIgbG9uZyBzZXF1ZW5jZXMKLSBJcyBhbXBsaWZpZWQgYnkgY2xpcHBpbmcKLSBDYXVzZXMgY2F0YXN0cm9waGljLCBpcnJldmVyc2libGUgbW9kZWwgY29sbGFwc2UKCioqQ29yZSBwcmluY2lwbGUgdmlvbGF0ZWQqKjogVGhlIHVuaXQgb2Ygb3B0aW1pemF0aW9uIG11c3QgbWF0Y2ggdGhlIHVuaXQgb2YgcmV3YXJkLiBTaW5jZSByZXdhcmRzIGFwcGx5IHRvIGVudGlyZSBzZXF1ZW5jZXMsIHRva2VuLWxldmVsIGNvcnJlY3Rpb24gaXMgZnVuZGFtZW50YWxseSBtaXNtYXRjaGVkLgoKIyMjIyBHU1BPJ3MgU2VxdWVuY2UtTGV2ZWwgU29sdXRpb24KCkdTUE8gZGVmaW5lcyBpbXBvcnRhbmNlIHJhdGlvcyBhdCB0aGUgc2VxdWVuY2UgbGV2ZWwgd2l0aCBsZW5ndGggbm9ybWFsaXphdGlvbjoKCiQkCnNfaShcdGhldGEpID0gXGxlZnQoXGZyYWN7XHBpX3tcdGhldGF9KHlfaXx4KX17XHBpX3tcdGhldGFfe1x0ZXh0e29sZH19fSh5X2l8eCl9XHJpZ2h0KV57XGZyYWN7MX17fHlfaXx9fQokJAoKRXhwYW5kaW5nIHRoZSBzZXF1ZW5jZSBsaWtlbGlob29kOgoKJCQKc19pKFx0aGV0YSkgPSBcZXhwXGxlZnQoXGZyYWN7MX17fHlfaXx9XHN1bV97dD0xfV57fHlfaXx9IFxsb2dcZnJhY3tccGlfe1x0aGV0YX0oeV97aSx0fXx4LCB5X3tpLDx0fSl9e1xwaV97XHRoZXRhX3tcdGV4dHtvbGR9fX0oeV97aSx0fXx4LCB5X3tpLDx0fSl9XHJpZ2h0KQokJAoKKipXaHkgbGVuZ3RoIG5vcm1hbGl6YXRpb24/KiogV2l0aG91dCBpdDoKLSBBIGZldyB0b2tlbiBjaGFuZ2VzIGNhdXNlIGRyYW1hdGljIHJhdGlvIGZsdWN0dWF0aW9ucwotIERpZmZlcmVudCBzZXF1ZW5jZSBsZW5ndGhzIG5lZWQgZGlmZmVyZW50IGNsaXBwaW5nIHJhbmdlcwotIE51bWVyaWNhbCBpbnN0YWJpbGl0eSBpbmNyZWFzZXMKCldpdGggbm9ybWFsaXphdGlvbiwgaW1wb3J0YW5jZSByYXRpb3Mgc3RheSBpbiBhIGNvbnRyb2xsZWQgcmFuZ2UgcmVnYXJkbGVzcyBvZiBzZXF1ZW5jZSBsZW5ndGguCgojIyMjIEdTUE8gT2JqZWN0aXZlCgpUaGUgY2xpcHBlZCBvYmplY3RpdmUgaXM6CgokJApKX3tcdGV4dHtHU1BPfX0oXHRoZXRhKSA9IFxtYXRoYmJ7RX1fe3hcc2ltIEQsIFx7eV9pXH1fe2k9MX1eRyBcc2ltIFxwaV97XHRoZXRhX3tcdGV4dHtvbGR9fX0oXGNkb3R8eCl9XGxlZnRbXGZyYWN7MX17R31cc3VtX3tpPTF9XkcgXG1pblxsZWZ0KHNfaShcdGhldGEpXGhhdHtBfV9pLCBcdGV4dHtjbGlwfShzX2koXHRoZXRhKSwgMS1cZXBzaWxvbiwgMStcZXBzaWxvbilcaGF0e0F9X2lccmlnaHQpXHJpZ2h0XQokJAoKV2hlcmUgYWR2YW50YWdlcyBhcmUgY29tcHV0ZWQgZnJvbSByZXdhcmRzOgoKJCQKXGhhdHtBfV9pID0gXGZyYWN7cih4LCB5X2kpIC0gXHRleHR7bWVhbn0oXHtyKHgsIHlfaSlcfV97aT0xfV5HKX17XHRleHR7c3RkfShce3IoeCwgeV9pKVx9X3tpPTF9XkcpfQokJAoKKipLZXkgY29tcG9uZW50cyoqOgoxLiAqKkdyb3VwLWJhc2VkIGFkdmFudGFnZXMqKjogTm9ybWFsaXplZCByZXdhcmRzIHdpdGhpbiBhIGdyb3VwIG9mICRHJCByZXNwb25zZXMKMi4gKipTZXF1ZW5jZS1sZXZlbCBjbGlwcGluZyoqOiBFbnRpcmUgc2VxdWVuY2VzIGFyZSBjbGlwcGVkLCBub3QgaW5kaXZpZHVhbCB0b2tlbnMKMy4gKipQZXNzaW1pc3RpYyBib3VuZCoqOiBUYWtlIG1pbmltdW0gb2YgY2xpcHBlZCBhbmQgdW5jbGlwcGVkIG9iamVjdGl2ZXMKCiMjIyMgQWxnb3JpdGhtIFN0ZXBzCgoqKjEuIENvbXB1dGUgQWR2YW50YWdlcyoqCgpHaXZlbiBhIGdyb3VwIG9mICRHJCBzZXF1ZW5jZXMgd2l0aCByZXdhcmRzICRce3JfaVx9X3tpPTF9XkckOgoKJCQKXHRleHR7bWVhbn0gPSBcZnJhY3sxfXtHfVxzdW1fe2k9MX1eRyByX2ksIFxxdWFkIFx0ZXh0e3N0ZH0gPSBcc3FydHtcZnJhY3sxfXtHfVxzdW1fe2k9MX1eRyAocl9pIC0gXHRleHR7bWVhbn0pXjJ9CiQkCgokJApcaGF0e0F9X2kgPSBcZnJhY3tyX2kgLSBcdGV4dHttZWFufX17XHRleHR7c3RkfX0KJCQKCioqMi4gQ29tcHV0ZSBTZXF1ZW5jZSBJbXBvcnRhbmNlIFJhdGlvcyoqCgpGb3IgZWFjaCBzZXF1ZW5jZSAkeV9pJCBvZiBsZW5ndGggJHx5X2l8JDoKCiQkClx0ZXh0e2xvZ1xfcmF0aW9cX3N1bX0gPSBcc3VtX3t0PTF9Xnt8eV9pfH0gXGxlZnQoXGxvZ1xwaV97XHRoZXRhfSh5X3tpLHR9fHgsIHlfe2ksPHR9KSAtIFxsb2dccGlfe1x0aGV0YV97XHRleHR7b2xkfX19KHlfe2ksdH18eCwgeV97aSw8dH0pXHJpZ2h0KQokJAoKJCQKc19pID0gXGV4cFxsZWZ0KFxmcmFje1x0ZXh0e2xvZ1xfcmF0aW9cX3N1bX19e3x5X2l8fVxyaWdodCkKJCQKCioqMy4gQXBwbHkgQ2xpcHBpbmcqKgoKQ29tcHV0ZSBib3RoIG9iamVjdGl2ZXM6CgokJApcdGV4dHt1bmNsaXBwZWR9X2kgPSBzX2kgXGNkb3QgXGhhdHtBfV9pCiQkCgokJApcdGV4dHtjbGlwcGVkfV9pID0gXHRleHR7Y2xpcH0oc19pLCAxLVxlcHNpbG9uLCAxK1xlcHNpbG9uKSBcY2RvdCBcaGF0e0F9X2kKJCQKClRha2UgcGVzc2ltaXN0aWMgYm91bmQ6CgokJApcdGV4dHtvYmplY3RpdmV9X2kgPSBcbWluKFx0ZXh0e3VuY2xpcHBlZH1faSwgXHRleHR7Y2xpcHBlZH1faSkKJCQKCioqNC4gQXZlcmFnZSoqCgokJApKX3tcdGV4dHtHU1BPfX0gPSBcZnJhY3sxfXtHfVxzdW1fe2k9MX1eRyBcdGV4dHtvYmplY3RpdmV9X2kKJCQKCiMjIyMgRXhhbXBsZSBDYWxjdWxhdGlvbgoKR2l2ZW46Ci0gMiBzZXF1ZW5jZXM6ICR5XzEkIChsZW5ndGggMiksICR5XzIkIChsZW5ndGggMykKLSBMb2cgcHJvYnMgbmV3OiAkW1stMC4yLCAtMC4zXSwgWy0wLjEsIC0wLjQsIC0wLjJdXSQKLSBMb2cgcHJvYnMgb2xkOiAkW1stMC41LCAtMC42XSwgWy0wLjQsIC0wLjcsIC0wLjVdXSQKLSBSZXdhcmRzOiAkWzAuOSwgMC43XSQKLSAkXGVwc2lsb24gPSAwLjIkCgoqKlN0ZXAgMTogQWR2YW50YWdlcyoqCgokJApcdGV4dHttZWFufSA9IDAuOCwgXHF1YWQgXHRleHR7c3RkfSA9IDAuMQokJAoKJCQKXGhhdHtBfV8xID0gXGZyYWN7MC45IC0gMC44fXswLjF9ID0gMS4wLCBccXVhZCBcaGF0e0F9XzIgPSBcZnJhY3swLjcgLSAwLjh9ezAuMX0gPSAtMS4wCiQkCgoqKlN0ZXAgMjogSW1wb3J0YW5jZSBSYXRpb3MqKgoKRm9yICR5XzEkOgokJApcdGV4dHtsb2dcX3JhdGlvXF9zdW19ID0gKC0wLjIgLSAoLTAuNSkpICsgKC0wLjMgLSAoLTAuNikpID0gMC4zICsgMC4zID0gMC42CiQkCgokJApzXzEgPSBcZXhwKDAuNiAvIDIpID0gXGV4cCgwLjMpID0gMS4zNDk5CiQkCgpGb3IgJHlfMiQ6CiQkClx0ZXh0e2xvZ1xfcmF0aW9cX3N1bX0gPSAwLjMgKyAwLjMgKyAwLjMgPSAwLjkKJCQKCiQkCnNfMiA9IFxleHAoMC45IC8gMykgPSBcZXhwKDAuMykgPSAxLjM0OTkKJCQKCioqU3RlcCAzOiBDbGlwcGluZyoqCgpCb3RoICRzXzEsIHNfMiA+IDEgKyBcZXBzaWxvbiA9IDEuMiQsIHNvIGJvdGggYXJlIGNsaXBwZWQgdG8gMS4yLgoKRm9yICR5XzEkIChwb3NpdGl2ZSBhZHZhbnRhZ2UpOgokJApcdGV4dHt1bmNsaXBwZWR9ID0gMS4zNDk5IFx0aW1lcyAxLjAgPSAxLjM0OTkKJCQKJCQKXHRleHR7Y2xpcHBlZH0gPSAxLjIgXHRpbWVzIDEuMCA9IDEuMgokJAokJApcdGV4dHtvYmplY3RpdmV9XzEgPSBcbWluKDEuMzQ5OSwgMS4yKSA9IDEuMgokJAoKRm9yICR5XzIkIChuZWdhdGl2ZSBhZHZhbnRhZ2UpOgokJApcdGV4dHt1bmNsaXBwZWR9ID0gMS4zNDk5IFx0aW1lcyAoLTEuMCkgPSAtMS4zNDk5CiQkCiQkClx0ZXh0e2NsaXBwZWR9ID0gMS4yIFx0aW1lcyAoLTEuMCkgPSAtMS4yCiQkCiQkClx0ZXh0e29iamVjdGl2ZX1fMiA9IFxtaW4oLTEuMzQ5OSwgLTEuMikgPSAtMS4zNDk5CiQkCgoqKlN0ZXAgNDogQXZlcmFnZSoqCgokJApKX3tcdGV4dHtHU1BPfX0gPSBcZnJhY3sxLjIgKyAoLTEuMzQ5OSl9ezJ9ID0gLTAuMDc0OQokJAoKIyMjIyBHcmFkaWVudCBBbmFseXNpcwoKVGhlIGtleSBkaWZmZXJlbmNlIGJldHdlZW4gR1NQTyBhbmQgR1JQTyBncmFkaWVudHM6CgoqKkdTUE8gZ3JhZGllbnQqKjoKJCQKXG5hYmxhX3tcdGhldGF9Sl97XHRleHR7R1NQT319ID0gXG1hdGhiYntFfVxsZWZ0W1xmcmFjezF9e0d9XHN1bV97aT0xfV5HIFxsZWZ0KFxmcmFje1xwaV97XHRoZXRhfSh5X2l8eCl9e1xwaV97XHRoZXRhX3tcdGV4dHtvbGR9fX0oeV9pfHgpfVxyaWdodClee1xmcmFjezF9e3x5X2l8fX0gXGhhdHtBfV9pIFxjZG90IFxmcmFjezF9e3x5X2l8fVxzdW1fe3Q9MX1ee3x5X2l8fSBcbmFibGFfe1x0aGV0YX1cbG9nXHBpX3tcdGhldGF9KHlfe2ksdH18eCwgeV97aSw8dH0pXHJpZ2h0XQokJAoKKipHUlBPIGdyYWRpZW50Kio6CiQkClxuYWJsYV97XHRoZXRhfUpfe1x0ZXh0e0dSUE99fSA9IFxtYXRoYmJ7RX1cbGVmdFtcZnJhY3sxfXtHfVxzdW1fe2k9MX1eRyBcaGF0e0F9X2kgXGNkb3QgXGZyYWN7MX17fHlfaXx9XHN1bV97dD0xfV57fHlfaXx9IFxmcmFje1xwaV97XHRoZXRhfSh5X3tpLHR9fHgsIHlfe2ksPHR9KX17XHBpX3tcdGhldGFfe1x0ZXh0e29sZH19fSh5X3tpLHR9fHgsIHlfe2ksPHR9KX0gXG5hYmxhX3tcdGhldGF9XGxvZ1xwaV97XHRoZXRhfSh5X3tpLHR9fHgsIHlfe2ksPHR9KVxyaWdodF0KJCQKCioqQ3JpdGljYWwgZGlzdGluY3Rpb24qKjogCi0gKipHU1BPKio6IEFsbCB0b2tlbnMgd2VpZ2h0ZWQgZXF1YWxseSBieSBzZXF1ZW5jZS1sZXZlbCByYXRpbwotICoqR1JQTyoqOiBUb2tlbnMgd2VpZ2h0ZWQgdW5lcXVhbGx5IGJ5IGluZGl2aWR1YWwgdG9rZW4gcmF0aW9zCgpHUlBPJ3MgdW5lcXVhbCB3ZWlnaHRzIHZhcnkgaW4gJCgwLCAxK1xlcHNpbG9uXSQgb3IgJFsxLVxlcHNpbG9uLCArXGluZnR5KSQgZGVwZW5kaW5nIG9uIGFkdmFudGFnZSBzaWduLiBUaGlzIHZhcmlhYmlsaXR5IGFjY3VtdWxhdGVzIGFuZCBjYXVzZXMgdW5wcmVkaWN0YWJsZSB0cmFpbmluZyBkeW5hbWljcy4KCiMjIyMgV2h5IEdTUE8gV29ya3MKCioqVGhlb3JldGljYWwgc291bmRuZXNzKio6IEltcG9ydGFuY2UgcmF0aW8gYmFzZWQgb24gc2VxdWVuY2UgbGlrZWxpaG9vZCBhbGlnbnMgd2l0aCBpbXBvcnRhbmNlIHNhbXBsaW5nIHByaW5jaXBsZXMuCgoqKk51bWVyaWNhbCBzdGFiaWxpdHkqKjogTGVuZ3RoIG5vcm1hbGl6YXRpb24ga2VlcHMgcmF0aW9zIGluIGNvbnRyb2xsZWQgcmFuZ2UuCgoqKlRyYWluaW5nIHN0YWJpbGl0eSoqOiBFbGltaW5hdGVzIGhpZ2gtdmFyaWFuY2UgdG9rZW4tbGV2ZWwgbm9pc2UgdGhhdCBjYXVzZXMgY29sbGFwc2UuCgoqKk1vRSBjb21wYXRpYmlsaXR5Kio6IFJlc29sdmVzIGV4cGVydC1hY3RpdmF0aW9uIHZvbGF0aWxpdHkgaXNzdWVzLiBJbiBNb0UgbW9kZWxzLCB+MTAlIG9mIGV4cGVydHMgY2hhbmdlIGJldHdlZW4gZ3JhZGllbnQgdXBkYXRlcyBmb3IgdGhlIHNhbWUgdG9rZW5zLCBtYWtpbmcgdG9rZW4tbGV2ZWwgcmF0aW9zIHVucmVsaWFibGUuIEdTUE8ncyBzZXF1ZW5jZS1sZXZlbCBhcHByb2FjaCBpcyByb2J1c3QgdG8gdGhlc2UgY2hhbmdlcyBzaW5jZSBvdmVyYWxsIGxhbmd1YWdlIG1vZGVsaW5nIGNhcGFiaWxpdHkgaXMgbWFpbnRhaW5lZC4KCioqSW5mcmFzdHJ1Y3R1cmUgc2ltcGxpZmljYXRpb24qKjogU2VxdWVuY2UtbGV2ZWwgbGlrZWxpaG9vZHMgdG9sZXJhdGUgcHJlY2lzaW9uIGRpc2NyZXBhbmNpZXMgYmV0d2VlbiB0cmFpbmluZyBhbmQgaW5mZXJlbmNlIGVuZ2luZXMsIHBvdGVudGlhbGx5IGVsaW1pbmF0aW5nIG5lZWQgZm9yIHJlY29tcHV0YXRpb24uCgojIyMjIEVtcGlyaWNhbCBCZW5lZml0cwoKKipTdXBlcmlvciBlZmZpY2llbmN5Kio6IEdTUE8gYWNoaWV2ZXMgYmV0dGVyIHBlcmZvcm1hbmNlIHdpdGggc2FtZSBjb21wdXRhdGlvbmFsIGJ1ZGdldC4KCioqU3RhYmxlIHNjYWxpbmcqKjogRW5hYmxlcyBjb250aW51b3VzIGltcHJvdmVtZW50IHRocm91Z2ggaW5jcmVhc2VkIGNvbXB1dGUsIGxvbmdlciBzZXF1ZW5jZXMsIGFuZCByZWd1bGFyIHF1ZXJ5IHVwZGF0ZXMuCgoqKkhpZ2hlciBjbGlwcGluZyB0b2xlcmFuY2UqKjogRGVzcGl0ZSBjbGlwcGluZyAxMDDDlyBtb3JlIHRva2VucyB0aGFuIEdSUE8gKDE1JSB2cyAwLjEzJSksIEdTUE8gYWNoaWV2ZXMgYmV0dGVyIHNhbXBsZSBlZmZpY2llbmN5LCBjb25maXJtaW5nIHRoYXQgR1JQTydzIHRva2VuLWxldmVsIGdyYWRpZW50cyBhcmUgaW5oZXJlbnRseSBub2lzeS4KCioqUHJvZHVjdGlvbiBzdWNjZXNzKio6IFBvd2VycyBRd2VuMyBtb2RlbHMsIGRlbW9uc3RyYXRpbmcgZWZmZWN0aXZlbmVzcyBhdCBzY2FsZS4=",
  "description_decoded": "Implement Group Sequence Policy Optimization (GSPO), a reinforcement learning algorithm for training large language models. Unlike token-level methods like GRPO that suffer from training instability, GSPO uses sequence-level importance ratios with length normalization. Given log probabilities from new and old policies along with rewards for a group of sequences, compute the clipped objective. The algorithm prevents catastrophic model collapse by applying clipping at the sequence level rather than token level.",
  "learn_section_decoded": "### Understanding GSPO\n\nGroup Sequence Policy Optimization (GSPO) is a breakthrough reinforcement learning algorithm from Alibaba's Qwen team that addresses critical stability issues in training large language models. It powers the latest Qwen3 models and represents a significant advancement over previous approaches.\n\n#### The Problem with Token-Level Methods\n\nPrevious algorithms like GRPO (Group Relative Policy Optimization) use token-level importance ratios:\n\n$$\nw_{i,t}(\\theta) = \\frac{\\pi_{\\theta}(y_{i,t}|x, y_{i,<t})}{\\pi_{\\theta_{\\text{old}}}(y_{i,t}|x, y_{i,<t})}\n$$\n\n**Critical flaw**: This ratio is based on a single sample $y_{i,t}$ from the distribution $\\pi_{\\theta_{\\text{old}}}(\\cdot|x, y_{i,<t})$, violating the fundamental principle of importance sampling. Importance sampling requires averaging over multiple samples to correct distributional mismatch:\n\n$$\n\\mathbb{E}_{z\\sim\\pi_{\\text{tar}}}[f(z)] = \\mathbb{E}_{z\\sim\\pi_{\\text{beh}}}\\left[\\frac{\\pi_{\\text{tar}}(z)}{\\pi_{\\text{beh}}(z)} f(z)\\right]\n$$\n\nWith only one sample per token position, the token-level weight introduces high-variance noise that:\n- Accumulates over long sequences\n- Is amplified by clipping\n- Causes catastrophic, irreversible model collapse\n\n**Core principle violated**: The unit of optimization must match the unit of reward. Since rewards apply to entire sequences, token-level correction is fundamentally mismatched.\n\n#### GSPO's Sequence-Level Solution\n\nGSPO defines importance ratios at the sequence level with length normalization:\n\n$$\ns_i(\\theta) = \\left(\\frac{\\pi_{\\theta}(y_i|x)}{\\pi_{\\theta_{\\text{old}}}(y_i|x)}\\right)^{\\frac{1}{|y_i|}}\n$$\n\nExpanding the sequence likelihood:\n\n$$\ns_i(\\theta) = \\exp\\left(\\frac{1}{|y_i|}\\sum_{t=1}^{|y_i|} \\log\\frac{\\pi_{\\theta}(y_{i,t}|x, y_{i,<t})}{\\pi_{\\theta_{\\text{old}}}(y_{i,t}|x, y_{i,<t})}\\right)\n$$\n\n**Why length normalization?** Without it:\n- A few token changes cause dramatic ratio fluctuations\n- Different sequence lengths need different clipping ranges\n- Numerical instability increases\n\nWith normalization, importance ratios stay in a controlled range regardless of sequence length.\n\n#### GSPO Objective\n\nThe clipped objective is:\n\n$$\nJ_{\\text{GSPO}}(\\theta) = \\mathbb{E}_{x\\sim D, \\{y_i\\}_{i=1}^G \\sim \\pi_{\\theta_{\\text{old}}}(\\cdot|x)}\\left[\\frac{1}{G}\\sum_{i=1}^G \\min\\left(s_i(\\theta)\\hat{A}_i, \\text{clip}(s_i(\\theta), 1-\\epsilon, 1+\\epsilon)\\hat{A}_i\\right)\\right]\n$$\n\nWhere advantages are computed from rewards:\n\n$$\n\\hat{A}_i = \\frac{r(x, y_i) - \\text{mean}(\\{r(x, y_i)\\}_{i=1}^G)}{\\text{std}(\\{r(x, y_i)\\}_{i=1}^G)}\n$$\n\n**Key components**:\n1. **Group-based advantages**: Normalized rewards within a group of $G$ responses\n2. **Sequence-level clipping**: Entire sequences are clipped, not individual tokens\n3. **Pessimistic bound**: Take minimum of clipped and unclipped objectives\n\n#### Algorithm Steps\n\n**1. Compute Advantages**\n\nGiven a group of $G$ sequences with rewards $\\{r_i\\}_{i=1}^G$:\n\n$$\n\\text{mean} = \\frac{1}{G}\\sum_{i=1}^G r_i, \\quad \\text{std} = \\sqrt{\\frac{1}{G}\\sum_{i=1}^G (r_i - \\text{mean})^2}\n$$\n\n$$\n\\hat{A}_i = \\frac{r_i - \\text{mean}}{\\text{std}}\n$$\n\n**2. Compute Sequence Importance Ratios**\n\nFor each sequence $y_i$ of length $|y_i|$:\n\n$$\n\\text{log\\_ratio\\_sum} = \\sum_{t=1}^{|y_i|} \\left(\\log\\pi_{\\theta}(y_{i,t}|x, y_{i,<t}) - \\log\\pi_{\\theta_{\\text{old}}}(y_{i,t}|x, y_{i,<t})\\right)\n$$\n\n$$\ns_i = \\exp\\left(\\frac{\\text{log\\_ratio\\_sum}}{|y_i|}\\right)\n$$\n\n**3. Apply Clipping**\n\nCompute both objectives:\n\n$$\n\\text{unclipped}_i = s_i \\cdot \\hat{A}_i\n$$\n\n$$\n\\text{clipped}_i = \\text{clip}(s_i, 1-\\epsilon, 1+\\epsilon) \\cdot \\hat{A}_i\n$$\n\nTake pessimistic bound:\n\n$$\n\\text{objective}_i = \\min(\\text{unclipped}_i, \\text{clipped}_i)\n$$\n\n**4. Average**\n\n$$\nJ_{\\text{GSPO}} = \\frac{1}{G}\\sum_{i=1}^G \\text{objective}_i\n$$\n\n#### Example Calculation\n\nGiven:\n- 2 sequences: $y_1$ (length 2), $y_2$ (length 3)\n- Log probs new: $[[-0.2, -0.3], [-0.1, -0.4, -0.2]]$\n- Log probs old: $[[-0.5, -0.6], [-0.4, -0.7, -0.5]]$\n- Rewards: $[0.9, 0.7]$\n- $\\epsilon = 0.2$\n\n**Step 1: Advantages**\n\n$$\n\\text{mean} = 0.8, \\quad \\text{std} = 0.1\n$$\n\n$$\n\\hat{A}_1 = \\frac{0.9 - 0.8}{0.1} = 1.0, \\quad \\hat{A}_2 = \\frac{0.7 - 0.8}{0.1} = -1.0\n$$\n\n**Step 2: Importance Ratios**\n\nFor $y_1$:\n$$\n\\text{log\\_ratio\\_sum} = (-0.2 - (-0.5)) + (-0.3 - (-0.6)) = 0.3 + 0.3 = 0.6\n$$\n\n$$\ns_1 = \\exp(0.6 / 2) = \\exp(0.3) = 1.3499\n$$\n\nFor $y_2$:\n$$\n\\text{log\\_ratio\\_sum} = 0.3 + 0.3 + 0.3 = 0.9\n$$\n\n$$\ns_2 = \\exp(0.9 / 3) = \\exp(0.3) = 1.3499\n$$\n\n**Step 3: Clipping**\n\nBoth $s_1, s_2 > 1 + \\epsilon = 1.2$, so both are clipped to 1.2.\n\nFor $y_1$ (positive advantage):\n$$\n\\text{unclipped} = 1.3499 \\times 1.0 = 1.3499\n$$\n$$\n\\text{clipped} = 1.2 \\times 1.0 = 1.2\n$$\n$$\n\\text{objective}_1 = \\min(1.3499, 1.2) = 1.2\n$$\n\nFor $y_2$ (negative advantage):\n$$\n\\text{unclipped} = 1.3499 \\times (-1.0) = -1.3499\n$$\n$$\n\\text{clipped} = 1.2 \\times (-1.0) = -1.2\n$$\n$$\n\\text{objective}_2 = \\min(-1.3499, -1.2) = -1.3499\n$$\n\n**Step 4: Average**\n\n$$\nJ_{\\text{GSPO}} = \\frac{1.2 + (-1.3499)}{2} = -0.0749\n$$\n\n#### Gradient Analysis\n\nThe key difference between GSPO and GRPO gradients:\n\n**GSPO gradient**:\n$$\n\\nabla_{\\theta}J_{\\text{GSPO}} = \\mathbb{E}\\left[\\frac{1}{G}\\sum_{i=1}^G \\left(\\frac{\\pi_{\\theta}(y_i|x)}{\\pi_{\\theta_{\\text{old}}}(y_i|x)}\\right)^{\\frac{1}{|y_i|}} \\hat{A}_i \\cdot \\frac{1}{|y_i|}\\sum_{t=1}^{|y_i|} \\nabla_{\\theta}\\log\\pi_{\\theta}(y_{i,t}|x, y_{i,<t})\\right]\n$$\n\n**GRPO gradient**:\n$$\n\\nabla_{\\theta}J_{\\text{GRPO}} = \\mathbb{E}\\left[\\frac{1}{G}\\sum_{i=1}^G \\hat{A}_i \\cdot \\frac{1}{|y_i|}\\sum_{t=1}^{|y_i|} \\frac{\\pi_{\\theta}(y_{i,t}|x, y_{i,<t})}{\\pi_{\\theta_{\\text{old}}}(y_{i,t}|x, y_{i,<t})} \\nabla_{\\theta}\\log\\pi_{\\theta}(y_{i,t}|x, y_{i,<t})\\right]\n$$\n\n**Critical distinction**: \n- **GSPO**: All tokens weighted equally by sequence-level ratio\n- **GRPO**: Tokens weighted unequally by individual token ratios\n\nGRPO's unequal weights vary in $(0, 1+\\epsilon]$ or $[1-\\epsilon, +\\infty)$ depending on advantage sign. This variability accumulates and causes unpredictable training dynamics.\n\n#### Why GSPO Works\n\n**Theoretical soundness**: Importance ratio based on sequence likelihood aligns with importance sampling principles.\n\n**Numerical stability**: Length normalization keeps ratios in controlled range.\n\n**Training stability**: Eliminates high-variance token-level noise that causes collapse.\n\n**MoE compatibility**: Resolves expert-activation volatility issues. In MoE models, ~10% of experts change between gradient updates for the same tokens, making token-level ratios unreliable. GSPO's sequence-level approach is robust to these changes since overall language modeling capability is maintained.\n\n**Infrastructure simplification**: Sequence-level likelihoods tolerate precision discrepancies between training and inference engines, potentially eliminating need for recomputation.\n\n#### Empirical Benefits\n\n**Superior efficiency**: GSPO achieves better performance with same computational budget.\n\n**Stable scaling**: Enables continuous improvement through increased compute, longer sequences, and regular query updates.\n\n**Higher clipping tolerance**: Despite clipping 100× more tokens than GRPO (15% vs 0.13%), GSPO achieves better sample efficiency, confirming that GRPO's token-level gradients are inherently noisy.\n\n**Production success**: Powers Qwen3 models, demonstrating effectiveness at scale."
}