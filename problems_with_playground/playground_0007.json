{
  "problem_id": 7,
  "title": "Matrix Transformation ",
  "category": "Linear Algebra",
  "enabled": true,
  "type": "react",
  "code": "import React, { useState, useMemo, useRef, useEffect } from 'react';\n\n// ============================================\n// Design Tokens\n// ============================================\nconst theme = {\n  colors: {\n    primary: '#6366f1',\n    secondary: '#ffffff',\n    background: '#000000',\n    surface: '#0a0a0a',\n    surfaceAlt: '#111111',\n    border: '#1f1f1f',\n    text: '#ffffff',\n    textSecondary: '#a1a1aa',\n    textMuted: '#71717a',\n    success: '#22c55e',\n    error: '#ef4444',\n    matrixA: '#ec4899',\n    matrixT: '#22c55e',\n    matrixS: '#3b82f6',\n    result: '#f59e0b',\n    intermediate: '#a855f7',\n    gridLine: '#1a1a2e',\n  },\n  font: \"'JetBrains Mono', monospace\",\n};\n\n// ============================================\n// Icons\n// ============================================\nconst Icons = {\n  Play: ({ size = 24, color = 'currentColor' }) => (\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n      <polygon points=\"5 3 19 12 5 21 5 3\"/>\n    </svg>\n  ),\n  RotateCcw: ({ size = 24, color = 'currentColor' }) => (\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n      <path d=\"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\"/><path d=\"M3 3v5h5\"/>\n    </svg>\n  ),\n  ChevronDown: ({ size = 24, color = 'currentColor' }) => (\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n      <path d=\"m6 9 6 6 6-6\"/>\n    </svg>\n  ),\n  ChevronUp: ({ size = 24, color = 'currentColor' }) => (\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke={color} strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n      <path d=\"m18 15-6-6-6 6\"/>\n    </svg>\n  ),\n};\n\n// ============================================\n// Card Component\n// ============================================\nfunction Card({ children, style = {} }) {\n  return (\n    <div style={{\n      background: theme.colors.surface,\n      border: `1px solid ${theme.colors.border}`,\n      borderRadius: '12px',\n      padding: '20px',\n      ...style,\n    }}>\n      {children}\n    </div>\n  );\n}\n\n// ============================================\n// Compact Matrix Input\n// ============================================\nfunction CompactMatrix({ matrix, onChange, label, color, showDet = false }) {\n  const det = matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];\n  const isInvertible = Math.abs(det) > 0.0001;\n  \n  return (\n    <div style={{ textAlign: 'center' }}>\n      <div style={{\n        fontSize: '11px',\n        color: color,\n        fontWeight: '600',\n        marginBottom: '4px',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        gap: '4px',\n      }}>\n        {label}\n        {showDet && (\n          <span style={{\n            fontSize: '9px',\n            padding: '1px 4px',\n            borderRadius: '3px',\n            background: isInvertible ? `${theme.colors.success}20` : `${theme.colors.error}20`,\n            color: isInvertible ? theme.colors.success : theme.colors.error,\n          }}>\n            {isInvertible ? '✓' : '✗'}\n          </span>\n        )}\n      </div>\n      <div style={{\n        display: 'grid',\n        gridTemplateColumns: 'repeat(2, 1fr)',\n        gap: '2px',\n        padding: '4px',\n        background: `${color}10`,\n        borderRadius: '6px',\n        border: `1px solid ${color}30`,\n      }}>\n        {matrix.map((row, i) =>\n          row.map((val, j) => (\n            <input\n              key={`${i}-${j}`}\n              type=\"number\"\n              step=\"0.5\"\n              value={val}\n              onChange={(e) => {\n                const newMatrix = matrix.map((r, ri) =>\n                  r.map((c, ci) => (ri === i && ci === j ? parseFloat(e.target.value) || 0 : c))\n                );\n                onChange(newMatrix);\n              }}\n              style={{\n                width: '36px',\n                height: '28px',\n                background: theme.colors.surfaceAlt,\n                border: `1px solid ${theme.colors.border}`,\n                borderRadius: '4px',\n                color: theme.colors.text,\n                fontFamily: theme.font,\n                fontSize: '12px',\n                fontWeight: '600',\n                textAlign: 'center',\n                outline: 'none',\n              }}\n            />\n          ))\n        )}\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// Result Matrix Display\n// ============================================\nfunction ResultMatrix({ matrix, label, color }) {\n  if (!matrix) return null;\n  \n  return (\n    <div style={{ textAlign: 'center' }}>\n      <div style={{ fontSize: '11px', color: color, fontWeight: '600', marginBottom: '4px' }}>\n        {label}\n      </div>\n      <div style={{\n        display: 'grid',\n        gridTemplateColumns: 'repeat(2, 1fr)',\n        gap: '2px',\n        padding: '4px',\n        background: `${color}15`,\n        borderRadius: '6px',\n        border: `2px solid ${color}`,\n      }}>\n        {matrix.map((row, i) =>\n          row.map((val, j) => (\n            <div\n              key={`${i}-${j}`}\n              style={{\n                width: '36px',\n                height: '28px',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                background: theme.colors.surfaceAlt,\n                borderRadius: '4px',\n                color: color,\n                fontFamily: theme.font,\n                fontSize: '11px',\n                fontWeight: '600',\n              }}\n            >\n              {val.toFixed(1)}\n            </div>\n          ))\n        )}\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// Auto-scaling Transformation Canvas\n// ============================================\nfunction TransformCanvas({ originalMatrix, currentDisplayMatrix, currentStep, stepColor, stepLabel }) {\n  const canvasRef = useRef(null);\n  const size = 360;\n  const center = size / 2;\n  \n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    \n    ctx.fillStyle = theme.colors.background;\n    ctx.fillRect(0, 0, size, size);\n    \n    const transform = (x, y, mat) => [\n      mat[0][0] * x + mat[0][1] * y,\n      mat[1][0] * x + mat[1][1] * y,\n    ];\n    \n    // Get all corners of unit square for both matrices\n    const corners = [[0, 0], [1, 0], [1, 1], [0, 1]];\n    const origCorners = corners.map(([x, y]) => transform(x, y, originalMatrix));\n    const currentCorners = corners.map(([x, y]) => transform(x, y, currentDisplayMatrix));\n    \n    // Find max absolute value for scaling (consider both matrices)\n    let maxVal = 1;\n    [...origCorners, ...currentCorners].forEach(([x, y]) => {\n      maxVal = Math.max(maxVal, Math.abs(x), Math.abs(y));\n    });\n    \n    const padding = 1.4;\n    const scale = (size / 2 - 25) / (maxVal * padding);\n    \n    const toCanvas = (x, y) => [center + x * scale, center - y * scale];\n    \n    // Draw grid (based on current matrix)\n    ctx.strokeStyle = theme.colors.gridLine;\n    ctx.lineWidth = 1;\n    const gridRange = Math.ceil(maxVal * padding) + 1;\n    \n    for (let i = -gridRange; i <= gridRange; i++) {\n      ctx.beginPath();\n      const [x1, y1] = toCanvas(...transform(i, -gridRange, currentDisplayMatrix));\n      const [x2, y2] = toCanvas(...transform(i, gridRange, currentDisplayMatrix));\n      ctx.moveTo(x1, y1);\n      ctx.lineTo(x2, y2);\n      ctx.stroke();\n      \n      ctx.beginPath();\n      const [x3, y3] = toCanvas(...transform(-gridRange, i, currentDisplayMatrix));\n      const [x4, y4] = toCanvas(...transform(gridRange, i, currentDisplayMatrix));\n      ctx.moveTo(x3, y3);\n      ctx.lineTo(x4, y4);\n      ctx.stroke();\n    }\n    \n    // Draw axes\n    ctx.strokeStyle = '#444';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(0, center);\n    ctx.lineTo(size, center);\n    ctx.moveTo(center, 0);\n    ctx.lineTo(center, size);\n    ctx.stroke();\n    \n    // Draw axis scale labels\n    ctx.fillStyle = '#555';\n    ctx.font = '10px JetBrains Mono';\n    const labelDist = Math.ceil(maxVal * padding);\n    ctx.fillText(`${labelDist}`, center + labelDist * scale - 10, center + 15);\n    ctx.fillText(`-${labelDist}`, center - labelDist * scale - 5, center + 15);\n    \n    // Draw ORIGINAL unit square (always visible, dashed when transformed)\n    const showingOriginal = currentStep < 2;\n    ctx.strokeStyle = showingOriginal ? theme.colors.matrixA : `${theme.colors.matrixA}50`;\n    ctx.lineWidth = showingOriginal ? 3 : 2;\n    if (!showingOriginal) ctx.setLineDash([5, 5]);\n    ctx.beginPath();\n    corners.forEach((corner, idx) => {\n      const [tx, ty] = transform(corner[0], corner[1], originalMatrix);\n      const [cx, cy] = toCanvas(tx, ty);\n      if (idx === 0) ctx.moveTo(cx, cy);\n      else ctx.lineTo(cx, cy);\n    });\n    ctx.closePath();\n    ctx.stroke();\n    ctx.setLineDash([]);\n    \n    // Fill original square\n    ctx.fillStyle = showingOriginal ? `${theme.colors.matrixA}20` : `${theme.colors.matrixA}10`;\n    ctx.beginPath();\n    corners.forEach((corner, idx) => {\n      const [tx, ty] = transform(corner[0], corner[1], originalMatrix);\n      const [cx, cy] = toCanvas(tx, ty);\n      if (idx === 0) ctx.moveTo(cx, cy);\n      else ctx.lineTo(cx, cy);\n    });\n    ctx.closePath();\n    ctx.fill();\n    \n    // Draw CURRENT transformed square (only if different from original)\n    if (currentStep >= 2) {\n      ctx.strokeStyle = stepColor;\n      ctx.lineWidth = 3;\n      ctx.beginPath();\n      corners.forEach((corner, idx) => {\n        const [tx, ty] = transform(corner[0], corner[1], currentDisplayMatrix);\n        const [cx, cy] = toCanvas(tx, ty);\n        if (idx === 0) ctx.moveTo(cx, cy);\n        else ctx.lineTo(cx, cy);\n      });\n      ctx.closePath();\n      ctx.stroke();\n      \n      // Fill current square\n      ctx.fillStyle = `${stepColor}25`;\n      ctx.beginPath();\n      corners.forEach((corner, idx) => {\n        const [tx, ty] = transform(corner[0], corner[1], currentDisplayMatrix);\n        const [cx, cy] = toCanvas(tx, ty);\n        if (idx === 0) ctx.moveTo(cx, cy);\n        else ctx.lineTo(cx, cy);\n      });\n      ctx.closePath();\n      ctx.fill();\n    }\n    \n    // Draw basis vectors for current matrix\n    const drawArrow = (toX, toY, color, label) => {\n      const [fx, fy] = toCanvas(0, 0);\n      const [tx, ty] = toCanvas(toX, toY);\n      \n      ctx.strokeStyle = color;\n      ctx.lineWidth = 3;\n      ctx.beginPath();\n      ctx.moveTo(fx, fy);\n      ctx.lineTo(tx, ty);\n      ctx.stroke();\n      \n      const angle = Math.atan2(fy - ty, fx - tx);\n      const headLen = 12;\n      ctx.beginPath();\n      ctx.moveTo(tx, ty);\n      ctx.lineTo(tx + headLen * Math.cos(angle + 0.4), ty + headLen * Math.sin(angle + 0.4));\n      ctx.lineTo(tx + headLen * Math.cos(angle - 0.4), ty + headLen * Math.sin(angle - 0.4));\n      ctx.closePath();\n      ctx.fillStyle = color;\n      ctx.fill();\n      \n      // Label with background\n      ctx.font = 'bold 13px JetBrains Mono';\n      const labelX = tx + 18 * Math.cos(angle - Math.PI/2);\n      const labelY = ty + 18 * Math.sin(angle - Math.PI/2);\n      \n      ctx.fillStyle = theme.colors.background;\n      ctx.fillRect(labelX - 14, labelY - 10, 28, 16);\n      \n      ctx.fillStyle = color;\n      ctx.textAlign = 'center';\n      ctx.fillText(label, labelX, labelY + 4);\n      ctx.textAlign = 'left';\n    };\n    \n    const [e1x, e1y] = transform(1, 0, currentDisplayMatrix);\n    const [e2x, e2y] = transform(0, 1, currentDisplayMatrix);\n    drawArrow(e1x, e1y, theme.colors.matrixT, 'ê₁');\n    drawArrow(e2x, e2y, theme.colors.matrixS, 'ê₂');\n    \n    // Draw origin dot\n    const [ox, oy] = toCanvas(0, 0);\n    ctx.fillStyle = theme.colors.text;\n    ctx.beginPath();\n    ctx.arc(ox, oy, 5, 0, Math.PI * 2);\n    ctx.fill();\n    \n    // Draw step label\n    if (stepLabel) {\n      ctx.fillStyle = stepColor;\n      ctx.font = 'bold 14px JetBrains Mono';\n      ctx.textAlign = 'left';\n      ctx.fillText(stepLabel, 12, 24);\n    }\n    \n  }, [originalMatrix, currentDisplayMatrix, currentStep, stepColor, stepLabel]);\n  \n  return (\n    <canvas\n      ref={canvasRef}\n      width={size}\n      height={size}\n      style={{\n        borderRadius: '8px',\n        border: `1px solid ${theme.colors.border}`,\n        display: 'block',\n        margin: '0 auto',\n      }}\n    />\n  );\n}\n\n// ============================================\n// Math Step Component\n// ============================================\nfunction MathStep({ step, title, description, formula, isActive, color }) {\n  return (\n    <div style={{\n      padding: '12px 16px',\n      background: isActive ? `${color}10` : theme.colors.surfaceAlt,\n      border: `1px solid ${isActive ? color : theme.colors.border}`,\n      borderRadius: '8px',\n      opacity: isActive ? 1 : 0.5,\n      transition: 'all 0.3s ease',\n    }}>\n      <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '6px' }}>\n        <div style={{\n          width: '22px',\n          height: '22px',\n          borderRadius: '50%',\n          background: isActive ? color : theme.colors.border,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          fontSize: '11px',\n          fontWeight: '700',\n          color: isActive ? '#000' : theme.colors.textMuted,\n        }}>\n          {step}\n        </div>\n        <span style={{ fontSize: '13px', fontWeight: '600', color: isActive ? color : theme.colors.textMuted }}>\n          {title}\n        </span>\n      </div>\n      <div style={{ fontSize: '11px', color: theme.colors.textSecondary, marginBottom: '6px' }}>\n        {description}\n      </div>\n      <div style={{\n        fontFamily: theme.font,\n        fontSize: '12px',\n        color: isActive ? theme.colors.text : theme.colors.textMuted,\n        background: theme.colors.background,\n        padding: '8px 10px',\n        borderRadius: '4px',\n        overflowX: 'auto',\n      }}>\n        {formula}\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// Main Component\n// ============================================\nexport default function MatrixTransformation() {\n  const [matrixA, setMatrixA] = useState([[1, 2], [3, 4]]);\n  const [matrixT, setMatrixT] = useState([[2, 0], [0, 2]]);\n  const [matrixS, setMatrixS] = useState([[1, 1], [0, 1]]);\n  const [currentStep, setCurrentStep] = useState(-1);\n  const [isAnimating, setIsAnimating] = useState(false);\n  const [showMath, setShowMath] = useState(true);\n  \n  // Calculate determinants\n  const detT = matrixT[0][0] * matrixT[1][1] - matrixT[0][1] * matrixT[1][0];\n  const detS = matrixS[0][0] * matrixS[1][1] - matrixS[0][1] * matrixS[1][0];\n  const isValid = Math.abs(detT) > 0.0001 && Math.abs(detS) > 0.0001;\n  \n  // Calculate T inverse\n  const TInverse = useMemo(() => {\n    if (Math.abs(detT) < 0.0001) return null;\n    return [\n      [matrixT[1][1] / detT, -matrixT[0][1] / detT],\n      [-matrixT[1][0] / detT, matrixT[0][0] / detT],\n    ];\n  }, [matrixT, detT]);\n  \n  // Calculate intermediate: T^{-1} * A\n  const intermediate = useMemo(() => {\n    if (!TInverse) return null;\n    return [\n      [\n        TInverse[0][0] * matrixA[0][0] + TInverse[0][1] * matrixA[1][0],\n        TInverse[0][0] * matrixA[0][1] + TInverse[0][1] * matrixA[1][1],\n      ],\n      [\n        TInverse[1][0] * matrixA[0][0] + TInverse[1][1] * matrixA[1][0],\n        TInverse[1][0] * matrixA[0][1] + TInverse[1][1] * matrixA[1][1],\n      ],\n    ];\n  }, [TInverse, matrixA]);\n  \n  // Calculate result: T^{-1} * A * S\n  const result = useMemo(() => {\n    if (!intermediate || Math.abs(detS) < 0.0001) return null;\n    return [\n      [\n        intermediate[0][0] * matrixS[0][0] + intermediate[0][1] * matrixS[1][0],\n        intermediate[0][0] * matrixS[0][1] + intermediate[0][1] * matrixS[1][1],\n      ],\n      [\n        intermediate[1][0] * matrixS[0][0] + intermediate[1][1] * matrixS[1][0],\n        intermediate[1][0] * matrixS[0][1] + intermediate[1][1] * matrixS[1][1],\n      ],\n    ];\n  }, [intermediate, matrixS, detS]);\n  \n  // Determine which matrix to display based on current step\n  const { displayMatrix, stepColor, stepLabel } = useMemo(() => {\n    if (currentStep < 2) {\n      return { \n        displayMatrix: matrixA, \n        stepColor: theme.colors.matrixA,\n        stepLabel: 'A (original)'\n      };\n    } else if (currentStep === 2) {\n      return { \n        displayMatrix: intermediate || matrixA, \n        stepColor: theme.colors.intermediate,\n        stepLabel: 'T⁻¹A'\n      };\n    } else {\n      return { \n        displayMatrix: result || matrixA, \n        stepColor: theme.colors.result,\n        stepLabel: 'T⁻¹AS (final)'\n      };\n    }\n  }, [currentStep, matrixA, intermediate, result]);\n  \n  // Animate through steps\n  const animate = async () => {\n    if (!isValid) return;\n    setIsAnimating(true);\n    \n    for (let step = 0; step <= 3; step++) {\n      setCurrentStep(step);\n      await new Promise(r => setTimeout(r, 1500));\n    }\n    \n    setIsAnimating(false);\n  };\n  \n  const reset = () => {\n    setCurrentStep(-1);\n  };\n  \n  // Presets\n  const presets = [\n    { name: 'Scale ½', A: [[1, 2], [3, 4]], T: [[2, 0], [0, 2]], S: [[1, 0], [0, 1]] },\n    { name: 'Shear', A: [[1, 2], [3, 4]], T: [[1, 0], [0, 1]], S: [[1, 1], [0, 1]] },\n    { name: 'Combined', A: [[1, 2], [3, 4]], T: [[2, 0], [0, 2]], S: [[1, 1], [0, 1]] },\n    { name: 'Singular', A: [[1, 2], [3, 4]], T: [[1, 2], [2, 4]], S: [[1, 0], [0, 1]] },\n  ];\n\n  // Format matrix for display\n  const formatMatrix = (m) => {\n    if (!m) return '?';\n    return `[[${m[0][0].toFixed(2)}, ${m[0][1].toFixed(2)}], [${m[1][0].toFixed(2)}, ${m[1][1].toFixed(2)}]]`;\n  };\n\n  return (\n    <div style={{\n      minHeight: '100vh',\n      background: theme.colors.background,\n      color: theme.colors.text,\n      fontFamily: theme.font,\n      padding: '24px',\n    }}>\n      <div style={{ maxWidth: '700px', margin: '0 auto' }}>\n        {/* Header */}\n        <div style={{ marginBottom: '16px', textAlign: 'center' }}>\n          <h1 style={{ fontSize: '20px', fontWeight: '600', margin: '0 0 4px 0' }}>\n            Matrix Transformation: T⁻¹ A S\n          </h1>\n          <p style={{ color: theme.colors.textSecondary, fontSize: '12px', margin: 0 }}>\n            Change of basis — view matrix A from a different coordinate system\n          </p>\n        </div>\n        \n        {/* Presets */}\n        <div style={{ display: 'flex', gap: '6px', marginBottom: '12px', justifyContent: 'center' }}>\n          {presets.map(({ name, A, T, S }) => (\n            <button\n              key={name}\n              onClick={() => { setMatrixA(A); setMatrixT(T); setMatrixS(S); reset(); }}\n              style={{\n                padding: '4px 10px',\n                background: theme.colors.surfaceAlt,\n                border: `1px solid ${theme.colors.border}`,\n                borderRadius: '4px',\n                color: theme.colors.textSecondary,\n                fontFamily: theme.font,\n                fontSize: '11px',\n                cursor: 'pointer',\n              }}\n            >\n              {name}\n            </button>\n          ))}\n        </div>\n        \n        {/* Main Card */}\n        <Card>\n          {/* Matrix Inputs Row */}\n          <div style={{\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            gap: '8px',\n            marginBottom: '16px',\n          }}>\n            <CompactMatrix\n              matrix={matrixT}\n              onChange={(m) => { setMatrixT(m); reset(); }}\n              label=\"T\"\n              color={theme.colors.matrixT}\n              showDet={true}\n            />\n            <span style={{ color: theme.colors.textMuted, fontSize: '14px' }}>⁻¹</span>\n            <CompactMatrix\n              matrix={matrixA}\n              onChange={(m) => { setMatrixA(m); reset(); }}\n              label=\"A\"\n              color={theme.colors.matrixA}\n            />\n            <span style={{ color: theme.colors.textMuted, fontSize: '14px' }}>×</span>\n            <CompactMatrix\n              matrix={matrixS}\n              onChange={(m) => { setMatrixS(m); reset(); }}\n              label=\"S\"\n              color={theme.colors.matrixS}\n              showDet={true}\n            />\n            <span style={{ color: theme.colors.textMuted, fontSize: '14px' }}>=</span>\n            \n            {isValid ? (\n              currentStep >= 3 && result ? (\n                <ResultMatrix matrix={result} label=\"Result\" color={theme.colors.result} />\n              ) : (\n                <div style={{\n                  width: '84px',\n                  height: '72px',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  background: theme.colors.surfaceAlt,\n                  borderRadius: '6px',\n                  border: `1px dashed ${theme.colors.border}`,\n                  color: theme.colors.textMuted,\n                  fontSize: '11px',\n                }}>\n                  ?\n                </div>\n              )\n            ) : (\n              <div style={{\n                padding: '8px 12px',\n                background: `${theme.colors.error}15`,\n                borderRadius: '6px',\n                border: `1px solid ${theme.colors.error}40`,\n                color: theme.colors.error,\n                fontSize: '16px',\n                fontWeight: '700',\n              }}>\n                -1\n              </div>\n            )}\n          </div>\n          \n          {/* Error message */}\n          {!isValid && (\n            <div style={{\n              padding: '8px 12px',\n              background: `${theme.colors.error}10`,\n              borderRadius: '6px',\n              marginBottom: '16px',\n              fontSize: '11px',\n              color: theme.colors.error,\n              textAlign: 'center',\n            }}>\n              {Math.abs(detT) < 0.0001 ? 'T' : 'S'} is singular (det=0) — cannot invert. Returns -1\n            </div>\n          )}\n          \n          {/* Canvas - now updates at each step */}\n          <TransformCanvas\n            originalMatrix={matrixA}\n            currentDisplayMatrix={displayMatrix}\n            currentStep={currentStep}\n            stepColor={stepColor}\n            stepLabel={currentStep >= 0 ? stepLabel : null}\n          />\n          \n          {/* Legend */}\n          <div style={{\n            display: 'flex',\n            justifyContent: 'center',\n            gap: '12px',\n            marginTop: '12px',\n            fontSize: '11px',\n            flexWrap: 'wrap',\n          }}>\n            <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\n              <div style={{ width: '12px', height: '3px', background: theme.colors.matrixA, borderRadius: '2px', opacity: currentStep >= 2 ? 0.5 : 1 }} />\n              <span style={{ color: theme.colors.textSecondary }}>A (original)</span>\n            </div>\n            {currentStep >= 2 && (\n              <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\n                <div style={{ width: '12px', height: '3px', background: currentStep === 2 ? theme.colors.intermediate : theme.colors.result, borderRadius: '2px' }} />\n                <span style={{ color: theme.colors.textSecondary }}>{currentStep === 2 ? 'T⁻¹A' : 'T⁻¹AS'}</span>\n              </div>\n            )}\n            <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\n              <div style={{ width: '12px', height: '3px', background: theme.colors.matrixT, borderRadius: '2px' }} />\n              <span style={{ color: theme.colors.textSecondary }}>ê₁</span>\n            </div>\n            <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\n              <div style={{ width: '12px', height: '3px', background: theme.colors.matrixS, borderRadius: '2px' }} />\n              <span style={{ color: theme.colors.textSecondary }}>ê₂</span>\n            </div>\n          </div>\n          \n          {/* Controls */}\n          <div style={{ display: 'flex', gap: '8px', marginTop: '16px' }}>\n            <button\n              onClick={animate}\n              disabled={isAnimating || !isValid}\n              style={{\n                flex: 1,\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                gap: '6px',\n                padding: '10px',\n                background: isValid ? theme.colors.primary : theme.colors.surfaceAlt,\n                border: 'none',\n                borderRadius: '6px',\n                color: isValid ? theme.colors.secondary : theme.colors.textMuted,\n                fontFamily: theme.font,\n                fontSize: '12px',\n                fontWeight: '600',\n                cursor: isValid ? 'pointer' : 'not-allowed',\n              }}\n            >\n              <Icons.Play size={14} />\n              {isAnimating ? 'Computing...' : 'Step Through'}\n            </button>\n            \n            <button\n              onClick={reset}\n              style={{\n                padding: '10px 14px',\n                background: theme.colors.surfaceAlt,\n                border: `1px solid ${theme.colors.border}`,\n                borderRadius: '6px',\n                color: theme.colors.textSecondary,\n                cursor: 'pointer',\n              }}\n            >\n              <Icons.RotateCcw size={14} />\n            </button>\n            \n            <button\n              onClick={() => setShowMath(!showMath)}\n              style={{\n                padding: '10px 14px',\n                background: showMath ? `${theme.colors.primary}20` : theme.colors.surfaceAlt,\n                border: `1px solid ${showMath ? theme.colors.primary : theme.colors.border}`,\n                borderRadius: '6px',\n                color: showMath ? theme.colors.primary : theme.colors.textSecondary,\n                cursor: 'pointer',\n                display: 'flex',\n                alignItems: 'center',\n                gap: '4px',\n                fontSize: '12px',\n              }}\n            >\n              Math\n              {showMath ? <Icons.ChevronUp size={14} /> : <Icons.ChevronDown size={14} />}\n            </button>\n          </div>\n        </Card>\n        \n        {/* Math Steps Section */}\n        {showMath && isValid && (\n          <Card style={{ marginTop: '16px' }}>\n            <div style={{\n              fontSize: '12px',\n              color: theme.colors.textMuted,\n              textTransform: 'uppercase',\n              letterSpacing: '0.5px',\n              marginBottom: '12px',\n            }}>\n              Step-by-Step Calculation\n            </div>\n            \n            <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n              <MathStep\n                step={1}\n                title=\"Check Invertibility\"\n                description=\"Both T and S must have non-zero determinants\"\n                formula={`det(T) = ${detT.toFixed(1)} ${Math.abs(detT) > 0.0001 ? '✓' : '✗'}  |  det(S) = ${detS.toFixed(1)} ${Math.abs(detS) > 0.0001 ? '✓' : '✗'}`}\n                isActive={currentStep >= 0}\n                color={theme.colors.matrixT}\n              />\n              \n              <MathStep\n                step={2}\n                title=\"Compute T⁻¹\"\n                description=\"Invert T using the 2×2 inverse formula: swap diagonals, negate off-diagonals, divide by det\"\n                formula={TInverse ? `T⁻¹ = ${formatMatrix(TInverse)}` : 'Cannot compute'}\n                isActive={currentStep >= 1}\n                color={theme.colors.matrixT}\n              />\n              \n              <MathStep\n                step={3}\n                title=\"Multiply T⁻¹ × A → Graph updates!\"\n                description=\"First matrix multiplication: apply inverse of T to A\"\n                formula={intermediate ? `T⁻¹A = ${formatMatrix(intermediate)}` : '?'}\n                isActive={currentStep >= 2}\n                color={theme.colors.intermediate}\n              />\n              \n              <MathStep\n                step={4}\n                title=\"Multiply (T⁻¹A) × S → Final result!\"\n                description=\"Second matrix multiplication: apply S to get final result\"\n                formula={result ? `T⁻¹AS = ${formatMatrix(result)}` : '?'}\n                isActive={currentStep >= 3}\n                color={theme.colors.result}\n              />\n            </div>\n          </Card>\n        )}\n        \n        {/* Key Concepts */}\n        <Card style={{ marginTop: '16px' }}>\n          <div style={{\n            fontSize: '12px',\n            color: theme.colors.textMuted,\n            textTransform: 'uppercase',\n            letterSpacing: '0.5px',\n            marginBottom: '12px',\n          }}>\n            Key Concepts\n          </div>\n          \n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>\n            <div style={{\n              padding: '12px',\n              background: theme.colors.surfaceAlt,\n              borderRadius: '6px',\n              border: `1px solid ${theme.colors.border}`,\n            }}>\n              <div style={{ fontSize: '12px', color: theme.colors.primary, fontWeight: '600', marginBottom: '4px' }}>\n                Change of Basis\n              </div>\n              <div style={{ fontSize: '11px', color: theme.colors.textSecondary }}>\n                T⁻¹AS expresses A in a new coordinate system defined by T and S\n              </div>\n            </div>\n            \n            <div style={{\n              padding: '12px',\n              background: theme.colors.surfaceAlt,\n              borderRadius: '6px',\n              border: `1px solid ${theme.colors.border}`,\n            }}>\n              <div style={{ fontSize: '12px', color: theme.colors.success, fontWeight: '600', marginBottom: '4px' }}>\n                Invertibility Required\n              </div>\n              <div style={{ fontSize: '11px', color: theme.colors.textSecondary }}>\n                det ≠ 0 ensures no information is lost (dimensions preserved)\n              </div>\n            </div>\n            \n            <div style={{\n              padding: '12px',\n              background: theme.colors.surfaceAlt,\n              borderRadius: '6px',\n              border: `1px solid ${theme.colors.border}`,\n            }}>\n              <div style={{ fontSize: '12px', color: theme.colors.matrixT, fontWeight: '600', marginBottom: '4px' }}>\n                T⁻¹ Effect (Step 3)\n              </div>\n              <div style={{ fontSize: '11px', color: theme.colors.textSecondary }}>\n                Transforms the output space (left multiplication)\n              </div>\n            </div>\n            \n            <div style={{\n              padding: '12px',\n              background: theme.colors.surfaceAlt,\n              borderRadius: '6px',\n              border: `1px solid ${theme.colors.border}`,\n            }}>\n              <div style={{ fontSize: '12px', color: theme.colors.matrixS, fontWeight: '600', marginBottom: '4px' }}>\n                S Effect (Step 4)\n              </div>\n              <div style={{ fontSize: '11px', color: theme.colors.textSecondary }}>\n                Transforms the input space (right multiplication)\n              </div>\n            </div>\n          </div>\n        </Card>\n      </div>\n    </div>\n  );\n}",
  "settings": {
    "editorHeight": 600,
    "showPreview": true,
    "theme": "auto",
    "showEditor": false,
    "editorWidthPercentage": 35,
    "showConsole": false
  },
  "dependencies": {}
}