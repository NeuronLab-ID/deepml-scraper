{
  "problem_id": 46,
  "title": "Implement Precision Metric",
  "category": "Machine Learning",
  "enabled": true,
  "type": "react",
  "code": "import React, { useState, useRef, useMemo } from 'react';\n\n// --- THEME ---\nconst theme = {\n  colors: {\n    primary: '#8b5cf6',\n    background: '#0a0a0a',\n    surface: '#111111',\n    surfaceAlt: '#1a1a1a',\n    border: '#2a2a2a',\n    text: '#fafafa',\n    textSecondary: '#a1a1aa',\n    textMuted: '#52525b',\n    green: '#4ade80', // TP\n    red: '#f43f5e',   // FP\n    gray: '#3f3f46',  // TN/FN\n    blue: '#38bdf8',  // Pred = 1\n    code: '#e5e7eb',\n  },\n  font: \"'JetBrains Mono', monospace\",\n};\n\n// --- MOCK DATA ---\nconst INITIAL_POINTS = [\n  { id: 1, x: 300, y: 200, label: 1 }, { id: 2, x: 320, y: 180, label: 1 },\n  { id: 3, x: 280, y: 220, label: 1 }, { id: 4, x: 310, y: 240, label: 1 },\n  { id: 5, x: 150, y: 150, label: 0 }, { id: 6, x: 180, y: 300, label: 0 },\n  { id: 7, x: 400, y: 100, label: 0 }, { id: 8, x: 350, y: 350, label: 0 },\n  { id: 9, x: 100, y: 200, label: 0 }, { id: 10, x: 450, y: 200, label: 0 },\n  { id: 11, x: 260, y: 140, label: 1 }, { id: 12, x: 340, y: 260, label: 1 },\n  { id: 13, x: 200, y: 100, label: 0 }, { id: 14, x: 420, y: 320, label: 0 },\n  { id: 15, x: 290, y: 290, label: 0 }, { id: 16, x: 360, y: 160, label: 1 },\n  { id: 17, x: 220, y: 220, label: 0 }, { id: 18, x: 380, y: 280, label: 0 },\n];\n\nexport default function PrecisionPlayground() {\n  const [scope, setScope] = useState({ x: 300, y: 200, r: 100 });\n  const [dragging, setDragging] = useState(null);\n  const [hoveredId, setHoveredId] = useState(null); \n  const [points] = useState(INITIAL_POINTS);\n\n  // Computation\n  const stats = useMemo(() => {\n    let tp = 0, fp = 0, fn = 0, tn = 0;\n    \n    // Generate the arrays for the visualization\n    const y_true = [];\n    const y_pred = [];\n\n    points.forEach(p => {\n      const dx = p.x - scope.x;\n      const dy = p.y - scope.y;\n      const isSelected = Math.sqrt(dx*dx + dy*dy) <= scope.r;\n      \n      const actual = p.label;\n      const pred = isSelected ? 1 : 0;\n\n      y_true.push(actual);\n      y_pred.push(pred);\n\n      if (pred === 1 && actual === 1) tp++;\n      else if (pred === 1 && actual === 0) fp++;\n      else if (pred === 0 && actual === 1) fn++;\n      else tn++;\n    });\n\n    const precision = (tp + fp) === 0 ? 0 : tp / (tp + fp);\n    return { tp, fp, fn, tn, precision, y_true, y_pred };\n  }, [scope, points]);\n\n  return (\n    <div style={styles.container}>\n      {/* HEADER */}\n      <header style={styles.header}>\n        <div>\n          <h1 style={styles.title}>Precision Visualizer</h1>\n          <p style={styles.subtitle}>Mapping Prediction & Actual to Precision</p>\n        </div>\n        <div style={styles.scoreBox}>\n          <div style={{fontSize: 10, color: theme.colors.textMuted, textTransform:'uppercase'}}>Precision Score</div>\n          <div style={{fontSize: 32, fontWeight: 'bold', color: stats.precision === 1 ? theme.colors.green : stats.precision < 0.5 ? theme.colors.red : theme.colors.blue}}>\n            {stats.precision.toFixed(2)}\n          </div>\n        </div>\n      </header>\n\n      <div style={styles.mainLayout}>\n        {/* LEFT SIDEBAR */}\n        <div style={styles.sidebar}>\n          \n          {/* 1. Logic Matrix */}\n          <div style={styles.card}>\n            <div style={styles.cardHeader}>1. The Logic Matrix</div>\n            <div style={{display:'grid', gridTemplateColumns: '1fr 1fr', gap: 8, fontSize: 12}}>\n              {/* Header Row */}\n              <div style={{gridColumn: '1 / -1', display:'flex', justifyContent:'space-between', paddingBottom: 4, borderBottom:`1px solid ${theme.colors.border}`, color: theme.colors.textMuted}}>\n                 <span>If Prediction is...</span>\n                 <span>And Actual is...</span>\n              </div>\n\n              {/* TP Row */}\n              <div style={styles.matrixCell(true)}>\n                 <div style={{fontWeight:'bold', color: theme.colors.blue}}>1 (Selected)</div>\n                 <div>+</div>\n                 <div style={{fontWeight:'bold', color: theme.colors.green}}>1 (Gold)</div>\n                 <div>=</div>\n                 <div style={{fontWeight:'bold', color: theme.colors.green, background: `${theme.colors.green}20`, padding:'2px 6px', borderRadius: 4}}>TP</div>\n              </div>\n\n              {/* FP Row */}\n              <div style={styles.matrixCell(true)}>\n                 <div style={{fontWeight:'bold', color: theme.colors.blue}}>1 (Selected)</div>\n                 <div>+</div>\n                 <div style={{fontWeight:'bold', color: theme.colors.red}}>0 (Noise)</div>\n                 <div>=</div>\n                 <div style={{fontWeight:'bold', color: theme.colors.red, background: `${theme.colors.red}20`, padding:'2px 6px', borderRadius: 4}}>FP</div>\n              </div>\n            </div>\n            <div style={{marginTop: 8, fontSize: 11, color: theme.colors.textMuted, fontStyle:'italic'}}>\n              Precision only cares when Prediction = 1.\n            </div>\n          </div>\n\n          {/* 2. Formula Breakdown */}\n          <div style={styles.card}>\n            <div style={styles.cardHeader}>2. The Calculation</div>\n            <div style={styles.mathBlock}>\n               <div style={{display:'flex', alignItems:'center', justifyContent:'center', gap: 12}}>\n                  <div style={{fontSize: 14}}>Precision =</div>\n                  <div style={{display:'flex', flexDirection:'column', alignItems:'center'}}>\n                     <div style={{color: theme.colors.green, fontWeight:'bold', fontSize: 16}}>{stats.tp}</div>\n                     <div style={{height: 1, width: '100%', background: theme.colors.border, margin:'2px 0'}} />\n                     <div style={{display:'flex', gap: 4, fontSize: 14}}>\n                        <span style={{color: theme.colors.green, fontWeight:'bold'}}>{stats.tp}</span>\n                        <span>+</span>\n                        <span style={{color: theme.colors.red, fontWeight:'bold'}}>{stats.fp}</span>\n                     </div>\n                  </div>\n               </div>\n            </div>\n          </div>\n\n        </div>\n\n        {/* RIGHT: PLOT */}\n        <div style={styles.canvasContainer}>\n          <PlaygroundCanvas \n            points={points} \n            scope={scope} \n            setScope={setScope}\n            dragging={dragging}\n            setDragging={setDragging}\n            theme={theme}\n            hoveredId={hoveredId}\n            setHoveredId={setHoveredId}\n          />\n          <div style={styles.overlayInstruction}>\n             Move the Blue Circle to change Predictions\n          </div>\n        </div>\n      </div>\n\n      {/* BOTTOM: DATA ARRAYS */}\n      <div style={styles.codePanel}>\n        <div style={styles.cardHeader}>3. Live Data Stream (Hover to Magnify)</div>\n        <div style={{display:'flex', gap: 10, overflowX: 'auto', paddingBottom: 12, paddingTop: 12, alignItems: 'center'}}>\n           <div style={{display:'flex', flexDirection:'column', gap: 8}}>\n              <div style={{fontFamily: theme.font, fontSize: 12, color: theme.colors.textMuted, height: 24, display:'flex', alignItems:'center'}}>y_pred = [</div>\n              <div style={{fontFamily: theme.font, fontSize: 12, color: theme.colors.textMuted, height: 24, display:'flex', alignItems:'center'}}>y_true = [</div>\n           </div>\n           \n           <div style={{display:'flex', alignItems:'center'}}>\n             {stats.y_pred.map((pred, i) => {\n               const actual = stats.y_true[i];\n               const isTP = pred === 1 && actual === 1;\n               const isFP = pred === 1 && actual === 0;\n               const isHovered = points[i].id === hoveredId;\n\n               return (\n                 <div \n                    key={i} \n                    style={styles.arrayCol(isHovered)} \n                    onMouseEnter={() => setHoveredId(points[i].id)}\n                    onMouseLeave={() => setHoveredId(null)}\n                 >\n                    <div style={styles.arrayCell(pred === 1 ? theme.colors.blue : theme.colors.gray)}>{pred}</div>\n                    <div style={styles.arrayCell(actual === 1 ? theme.colors.green : theme.colors.red)}>{actual}</div>\n                    {/* Result Indicator */}\n                    <div style={{height: 4, width: '100%', marginTop: 4, borderRadius: 2, background: isTP ? theme.colors.green : isFP ? theme.colors.red : 'transparent'}} />\n                 </div>\n               )\n             })}\n           </div>\n           <div style={{display:'flex', flexDirection:'column', gap: 8}}>\n              <div style={{fontFamily: theme.font, fontSize: 12, color: theme.colors.textMuted, height: 24, display:'flex', alignItems:'center'}}>]</div>\n              <div style={{fontFamily: theme.font, fontSize: 12, color: theme.colors.textMuted, height: 24, display:'flex', alignItems:'center'}}>]</div>\n           </div>\n        </div>\n      </div>\n\n    </div>\n  );\n}\n\n// --- CANVAS COMPONENT ---\nconst PlaygroundCanvas = ({ points, scope, setScope, dragging, setDragging, theme, hoveredId, setHoveredId }) => {\n  const svgRef = useRef(null);\n  const width = 500;\n  const height = 300;\n\n  const handleStartMove = (e) => {\n    e.target.setPointerCapture(e.pointerId);\n    setDragging('move');\n    moveScopeTo(e.clientX, e.clientY);\n  };\n\n  const handleResizeStart = (e) => {\n    e.stopPropagation();\n    e.target.setPointerCapture(e.pointerId);\n    setDragging('resize');\n  };\n\n  const moveScopeTo = (cx, cy) => {\n    const rect = svgRef.current.getBoundingClientRect();\n    const x = cx - rect.left;\n    const y = cy - rect.top;\n    setScope(prev => ({ ...prev, x, y }));\n  };\n\n  const handlePointerMove = (e) => {\n    if (!dragging) return;\n    if (dragging === 'move') {\n      moveScopeTo(e.clientX, e.clientY);\n    } else if (dragging === 'resize') {\n      const rect = svgRef.current.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n      const dx = x - scope.x;\n      const dy = y - scope.y;\n      const newR = Math.max(30, Math.sqrt(dx*dx + dy*dy));\n      setScope(prev => ({ ...prev, r: newR }));\n    }\n  };\n\n  const handlePointerUp = () => setDragging(null);\n\n  return (\n    <svg \n      ref={svgRef}\n      width=\"100%\" height=\"100%\" viewBox={`0 0 ${width} ${height}`}\n      style={{background: theme.colors.surfaceAlt, cursor: dragging === 'move' ? 'none' : 'crosshair'}}\n      onPointerDown={handleStartMove}\n      onPointerMove={handlePointerMove}\n      onPointerUp={handlePointerUp}\n      onPointerLeave={handlePointerUp}\n    >\n      <defs>\n        <pattern id=\"grid\" width=\"40\" height=\"40\" patternUnits=\"userSpaceOnUse\">\n          <path d=\"M 40 0 L 0 0 0 40\" fill=\"none\" stroke={theme.colors.grid} strokeWidth=\"1\"/>\n        </pattern>\n      </defs>\n      <rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" style={{pointerEvents:'none'}} />\n\n      {/* POINTS */}\n      {points.map(p => {\n        const dx = p.x - scope.x;\n        const dy = p.y - scope.y;\n        const isSelected = Math.sqrt(dx*dx + dy*dy) <= scope.r;\n        const isHovered = p.id === hoveredId;\n        \n        // Colors\n        let fill = 'transparent';\n        let stroke = theme.colors.gray;\n        let r = isHovered ? 10 : 6;\n        let opacity = 0.5;\n\n        if (isSelected) {\n           opacity = 1;\n           r = isHovered ? 12 : 8;\n           if (p.label === 1) { // TP\n             fill = theme.colors.green; \n             stroke = '#fff'; \n           } else { // FP\n             fill = theme.colors.red; \n             stroke = '#fff'; \n           }\n        } else {\n           if (p.label === 1) { // FN\n              stroke = theme.colors.green;\n           }\n        }\n\n        return (\n          <g key={p.id} style={{opacity, transition: 'all 0.15s'}}>\n             {p.label === 1 \n                ? <circle cx={p.x} cy={p.y} r={r} fill={fill} stroke={stroke} strokeWidth={2} />\n                : <rect x={p.x-r} y={p.y-r} width={r*2} height={r*2} fill={fill} stroke={stroke} strokeWidth={2} rx={2} />\n             }\n             {/* Invisible Hover Target */}\n             <circle \n                cx={p.x} cy={p.y} r={20} fill=\"transparent\" \n                onMouseEnter={() => setHoveredId(p.id)}\n                onMouseLeave={() => setHoveredId(null)}\n                style={{pointerEvents: 'auto', cursor:'help'}}\n             />\n             {/* Tooltip on Hover */}\n             {isHovered && (\n                <g pointerEvents=\"none\" style={{zIndex: 100}}>\n                   <rect x={p.x + 15} y={p.y - 15} width={120} height={45} fill={theme.colors.surface} stroke={theme.colors.primary} strokeWidth={2} rx={4} />\n                   <text x={p.x + 22} y={p.y - 2} fill={theme.colors.text} fontSize=\"10\" fontFamily={theme.font}>Actual: {p.label}</text>\n                   <text x={p.x + 22} y={p.y + 10} fill={theme.colors.text} fontSize=\"10\" fontFamily={theme.font}>Pred: {isSelected?1:0}</text>\n                   <text x={p.x + 22} y={p.y + 22} fill={isSelected && p.label===0 ? theme.colors.red : theme.colors.green} fontSize=\"10\" fontFamily={theme.font} fontWeight=\"bold\">\n                      {isSelected && p.label===1 ? \"True Positive\" : isSelected && p.label===0 ? \"False Positive\" : \"Ignored\"}\n                   </text>\n                </g>\n             )}\n          </g>\n        );\n      })}\n\n      {/* SCOPE */}\n      <circle \n        cx={scope.x} cy={scope.y} r={scope.r} \n        fill={theme.colors.blue} fillOpacity=\"0.08\"\n        stroke={theme.colors.blue} strokeWidth=\"2\"\n        strokeDasharray=\"6,6\"\n        style={{pointerEvents: 'none'}}\n      />\n\n      {/* RESIZE HANDLE */}\n      <circle \n        cx={scope.x + scope.r} cy={scope.y} r=\"20\"\n        fill=\"transparent\" \n        onPointerDown={handleResizeStart}\n        style={{cursor: 'ew-resize', pointerEvents: 'auto'}}\n      />\n      <circle \n        cx={scope.x + scope.r} cy={scope.y} r=\"6\"\n        fill={theme.colors.background} stroke={theme.colors.blue} strokeWidth=\"2\"\n        style={{pointerEvents: 'none'}}\n      />\n    </svg>\n  );\n};\n\n// --- STYLES ---\nconst styles = {\n  container: {\n    fontFamily: theme.font,\n    background: theme.colors.background,\n    color: theme.colors.text,\n    minHeight: '100vh',\n    padding: 20,\n    display: 'flex', flexDirection: 'column',\n  },\n  header: {\n    display: 'flex', justifyContent: 'space-between', alignItems: 'center',\n    borderBottom: `1px solid ${theme.colors.border}`, paddingBottom: 16, marginBottom: 20\n  },\n  title: {\n    margin: 0, fontSize: 24, fontWeight: '700',\n    background: `linear-gradient(90deg, ${theme.colors.blue}, ${theme.colors.green})`,\n    WebkitBackgroundClip: 'text',\n    WebkitTextFillColor: 'transparent',\n  },\n  subtitle: { margin: '4px 0 0', fontSize: 13, color: theme.colors.textSecondary },\n  scoreBox: {\n    background: theme.colors.surfaceAlt, border: `1px solid ${theme.colors.border}`,\n    borderRadius: 8, padding: '8px 16px', textAlign: 'right'\n  },\n  mainLayout: {\n    display: 'grid', gridTemplateColumns: '280px 1fr', gap: 24, flex: 1, minHeight: 0 \n  },\n  sidebar: { display: 'flex', flexDirection: 'column', gap: 16 },\n  canvasContainer: {\n    position: 'relative', background: theme.colors.surfaceAlt,\n    borderRadius: 12, border: `1px solid ${theme.colors.border}`,\n    overflow: 'hidden', boxShadow: '0 4px 20px rgba(0,0,0,0.3)',\n  },\n  codePanel: {\n    marginTop: 20, background: theme.colors.surface, borderRadius: 8,\n    border: `1px solid ${theme.colors.border}`, padding: 12\n  },\n  card: {\n    background: theme.colors.surface, borderRadius: 8,\n    border: `1px solid ${theme.colors.border}`, padding: 12\n  },\n  cardHeader: {\n    fontSize: 11, fontWeight: 'bold', color: theme.colors.textSecondary,\n    textTransform: 'uppercase', letterSpacing: 1, marginBottom: 12\n  },\n  mathBlock: {\n    background: theme.colors.background, padding: 12, borderRadius: 6,\n    border: `1px solid ${theme.colors.border}`, fontFamily: theme.font, textAlign:'center'\n  },\n  matrixCell: (isRow) => ({\n    gridColumn: '1 / -1', display: 'flex', gap: 6, alignItems:'center', justifyContent:'center',\n    padding: '8px 0', borderBottom: `1px solid ${theme.colors.border}`\n  }),\n  overlayInstruction: {\n    position: 'absolute', bottom: 12, left: '50%', transform: 'translateX(-50%)',\n    background: 'rgba(0,0,0,0.7)', padding: '6px 14px', borderRadius: 20,\n    fontSize: 12, color: '#fff', pointerEvents: 'none',\n    whiteSpace: 'nowrap'\n  },\n  arrayCol: (isActive) => ({\n    display: 'flex', flexDirection:'column', alignItems:'center', gap: 4,\n    padding: '8px 4px',\n    background: isActive ? theme.colors.surface : 'transparent',\n    borderRadius: 8, \n    cursor: 'pointer',\n    transform: isActive ? 'scale(1.2) translateY(-5px)' : 'scale(1)',\n    boxShadow: isActive ? '0 10px 25px -5px rgba(0, 0, 0, 0.5)' : 'none',\n    border: isActive ? `1px solid ${theme.colors.primary}` : '1px solid transparent',\n    zIndex: isActive ? 50 : 1,\n    transition: 'all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1)',\n    margin: '0 2px'\n  }),\n  arrayCell: (color) => ({\n    width: 24, height: 24, borderRadius: 4, background: `${color}20`, \n    color: color, fontSize: 12, fontWeight: 'bold',\n    display:'flex', alignItems:'center', justifyContent:'center', border: `1px solid ${color}40`\n  })\n};\n",
  "settings": {
    "editorHeight": 600,
    "theme": "auto",
    "showEditor": false,
    "showPreview": true,
    "editorWidthPercentage": 35
  },
  "dependencies": {}
}