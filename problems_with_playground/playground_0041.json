{
  "problem_id": 41,
  "title": "Simple Convolutional 2D Layer",
  "category": "Deep Learning",
  "enabled": true,
  "type": "react",
  "code": "import React, { useState, useEffect } from 'react';\n\nconst theme = {\n  colors: {\n    primary: '#8b5cf6',\n    background: '#0a0a0a',\n    surface: '#111111',\n    surfaceAlt: '#1a1a1a',\n    border: '#2a2a2a',\n    text: '#fafafa',\n    textSecondary: '#a1a1aa',\n    textMuted: '#52525b',\n    blue: '#38bdf8',\n    yellow: '#fbbf24',\n    pink: '#f472b6',\n    green: '#a3e635',\n    orange: '#fb923c',\n    red: '#f87171',\n  },\n  font: \"'JetBrains Mono', monospace\",\n};\n\nexport default function App() {\n  const [padding, setPadding] = useState(0);\n  const [stride, setStride] = useState(1);\n  const [step, setStep] = useState(0);\n  const [playing, setPlaying] = useState(false);\n\n  // 4x4 input\n  const input = [\n    [1, 2, 3, 4],\n    [5, 6, 7, 8],\n    [9, 10, 11, 12],\n    [13, 14, 15, 16],\n  ];\n\n  // 2x2 kernel\n  const kernel = [\n    [1, 0],\n    [-1, 1],\n  ];\n\n  const kH = kernel.length, kW = kernel[0].length;\n  const inH = input.length, inW = input[0].length;\n\n  // Padded input\n  const paddedH = inH + 2 * padding;\n  const paddedW = inW + 2 * padding;\n  const padded = [];\n  for (let i = 0; i < paddedH; i++) {\n    const row = [];\n    for (let j = 0; j < paddedW; j++) {\n      const oi = i - padding, oj = j - padding;\n      if (oi >= 0 && oi < inH && oj >= 0 && oj < inW) {\n        row.push(input[oi][oj]);\n      } else {\n        row.push(0);\n      }\n    }\n    padded.push(row);\n  }\n\n  // Output dimensions\n  const outH = Math.floor((paddedH - kH) / stride) + 1;\n  const outW = Math.floor((paddedW - kW) / stride) + 1;\n  const totalSteps = outH * outW;\n\n  // Current position from step\n  const kernelRow = Math.floor(step / outW);\n  const kernelCol = step % outW;\n  const posR = kernelRow * stride;\n  const posC = kernelCol * stride;\n\n  // Compute full output\n  const output = [];\n  for (let i = 0; i < outH; i++) {\n    const row = [];\n    for (let j = 0; j < outW; j++) {\n      let sum = 0;\n      for (let ki = 0; ki < kH; ki++) {\n        for (let kj = 0; kj < kW; kj++) {\n          sum += padded[i * stride + ki][j * stride + kj] * kernel[ki][kj];\n        }\n      }\n      row.push(sum);\n    }\n    output.push(row);\n  }\n\n  // Extract current region\n  const region = [];\n  for (let ki = 0; ki < kH; ki++) {\n    const row = [];\n    for (let kj = 0; kj < kW; kj++) {\n      row.push(padded[posR + ki]?.[posC + kj] ?? 0);\n    }\n    region.push(row);\n  }\n\n  // Compute products\n  const products = [];\n  let sum = 0;\n  for (let ki = 0; ki < kH; ki++) {\n    for (let kj = 0; kj < kW; kj++) {\n      const val = region[ki][kj];\n      const kVal = kernel[ki][kj];\n      const prod = val * kVal;\n      products.push({ val, kVal, prod });\n      sum += prod;\n    }\n  }\n\n  // Animation\n  useEffect(() => {\n    if (!playing) return;\n    const timer = setTimeout(() => {\n      if (step < totalSteps - 1) {\n        setStep(s => s + 1);\n      } else {\n        setPlaying(false);\n      }\n    }, 700);\n    return () => clearTimeout(timer);\n  }, [playing, step, totalSteps]);\n\n  const play = () => { setStep(0); setPlaying(true); };\n  const reset = () => { setStep(0); setPlaying(false); };\n  const nextStep = () => { if (step < totalSteps - 1) setStep(s => s + 1); setPlaying(false); };\n  const prevStep = () => { if (step > 0) setStep(s => s - 1); setPlaying(false); };\n\n  const cellSize = 38;\n\n  const isInKernel = (r, c) => r >= posR && r < posR + kH && c >= posC && c < posC + kW;\n  const isPadding = (r, c) => {\n    const oi = r - padding, oj = c - padding;\n    return oi < 0 || oi >= inH || oj < 0 || oj >= inW;\n  };\n\n  return (\n    <div style={{ background: theme.colors.background, minHeight: '100vh', padding: '12px', fontFamily: theme.font, color: theme.colors.text }}>\n      \n      {/* Header with step controls */}\n      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '10px' }}>\n        <div>\n          <div style={{ fontSize: '18px', fontWeight: '700' }}>2D Convolution</div>\n          <div style={{ fontSize: '11px', color: theme.colors.textSecondary }}>Kernel slides over input, computing dot product at each position</div>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\n          <button onClick={prevStep} disabled={step === 0}\n            style={{ padding: '6px 12px', background: theme.colors.surface, border: 'none', borderRadius: '6px',\n              color: step === 0 ? theme.colors.textMuted : theme.colors.text, fontSize: '14px', cursor: 'pointer' }}>{'<'}</button>\n          <div style={{ display: 'flex', gap: '4px' }}>\n            {Array.from({ length: Math.min(totalSteps, 12) }, (_, i) => (\n              <div key={i} onClick={() => { setStep(i); setPlaying(false); }} style={{\n                width: i === step ? '14px' : '8px', height: '8px', borderRadius: '4px',\n                background: i <= step ? theme.colors.yellow : theme.colors.border, cursor: 'pointer',\n              }} />\n            ))}\n            {totalSteps > 12 && <span style={{ fontSize: '10px', color: theme.colors.textMuted }}>+{totalSteps - 12}</span>}\n          </div>\n          <button onClick={nextStep} disabled={step === totalSteps - 1}\n            style={{ padding: '6px 12px', background: step === totalSteps - 1 ? theme.colors.surface : theme.colors.primary,\n              border: 'none', borderRadius: '6px', color: theme.colors.text, fontSize: '14px', cursor: 'pointer' }}>{'>'}</button>\n          <button onClick={play} disabled={playing}\n            style={{ padding: '6px 12px', background: playing ? theme.colors.green : theme.colors.surface,\n              border: 'none', borderRadius: '6px', color: playing ? theme.colors.background : theme.colors.text,\n              fontSize: '12px', cursor: 'pointer' }}>{playing ? '...' : 'Play'}</button>\n          <button onClick={reset}\n            style={{ padding: '6px 10px', background: theme.colors.surface, border: 'none', borderRadius: '6px',\n              color: theme.colors.textSecondary, fontSize: '14px', cursor: 'pointer' }}>~</button>\n        </div>\n      </div>\n\n      {/* Controls */}\n      <div style={{ display: 'flex', gap: '20px', marginBottom: '12px', background: theme.colors.surface, borderRadius: '10px', padding: '10px 14px' }}>\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\n          <span style={{ fontSize: '12px', color: theme.colors.textMuted }}>Padding:</span>\n          {[0, 1, 2].map(p => (\n            <button key={p} onClick={() => { setPadding(p); setStep(0); }}\n              style={{ width: '30px', height: '30px', borderRadius: '6px', border: 'none', cursor: 'pointer',\n                background: padding === p ? theme.colors.blue : theme.colors.surfaceAlt,\n                color: padding === p ? theme.colors.background : theme.colors.text,\n                fontSize: '14px', fontWeight: '600' }}>{p}</button>\n          ))}\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\n          <span style={{ fontSize: '12px', color: theme.colors.textMuted }}>Stride:</span>\n          {[1, 2].map(s => (\n            <button key={s} onClick={() => { setStride(s); setStep(0); }}\n              style={{ width: '30px', height: '30px', borderRadius: '6px', border: 'none', cursor: 'pointer',\n                background: stride === s ? theme.colors.pink : theme.colors.surfaceAlt,\n                color: stride === s ? theme.colors.background : theme.colors.text,\n                fontSize: '14px', fontWeight: '600' }}>{s}</button>\n          ))}\n        </div>\n        <div style={{ marginLeft: 'auto', fontSize: '12px', color: theme.colors.textMuted }}>\n          Step {step + 1} of {totalSteps} → Output[{kernelRow}][{kernelCol}]\n        </div>\n      </div>\n\n      {/* Main visualization */}\n      <div style={{ display: 'flex', gap: '16px', alignItems: 'flex-start' }}>\n        \n        {/* Padded Input with kernel overlay */}\n        <div style={{ background: theme.colors.surface, borderRadius: '12px', padding: '14px' }}>\n          <div style={{ fontSize: '12px', color: theme.colors.blue, marginBottom: '8px', fontWeight: '600' }}>\n            Input {padding > 0 ? `(padded: ${paddedH}×${paddedW})` : `(${inH}×${inW})`}\n          </div>\n          <div style={{ display: 'grid', gridTemplateColumns: `repeat(${paddedW}, ${cellSize}px)`, gap: '3px' }}>\n            {padded.map((row, r) => row.map((val, c) => {\n              const inK = isInKernel(r, c);\n              const isPad = isPadding(r, c);\n              // Get kernel value if in kernel region\n              const ki = r - posR, kj = c - posC;\n              const kVal = inK ? kernel[ki][kj] : null;\n              \n              return (\n                <div key={`${r}-${c}`} style={{\n                  width: cellSize, height: cellSize, borderRadius: '5px',\n                  background: inK ? theme.colors.yellow + '30' : (isPad ? theme.colors.surfaceAlt : theme.colors.blue + '15'),\n                  border: `3px solid ${inK ? theme.colors.yellow : (isPad ? theme.colors.border : theme.colors.blue + '40')}`,\n                  display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',\n                  position: 'relative', transition: 'all 0.2s',\n                }}>\n                  <span style={{ fontSize: '14px', fontWeight: inK ? '700' : '500',\n                    color: inK ? theme.colors.text : (isPad ? theme.colors.textMuted : theme.colors.text) }}>\n                    {val}\n                  </span>\n                  {inK && (\n                    <span style={{ fontSize: '10px', color: theme.colors.orange, fontWeight: '700' }}>\n                      ×{kVal}\n                    </span>\n                  )}\n                </div>\n              );\n            }))}\n          </div>\n        </div>\n\n        {/* Middle: Region × Kernel = Sum */}\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '12px', alignItems: 'center', paddingTop: '30px' }}>\n          \n          {/* Extracted region */}\n          <div style={{ background: theme.colors.surface, borderRadius: '10px', padding: '10px' }}>\n            <div style={{ fontSize: '10px', color: theme.colors.yellow, marginBottom: '6px', textAlign: 'center' }}>Region</div>\n            <div style={{ display: 'grid', gridTemplateColumns: `repeat(${kW}, ${cellSize}px)`, gap: '3px' }}>\n              {region.map((row, r) => row.map((val, c) => (\n                <div key={`r-${r}-${c}`} style={{\n                  width: cellSize, height: cellSize, borderRadius: '5px',\n                  background: theme.colors.yellow + '30',\n                  border: `2px solid ${theme.colors.yellow}`,\n                  display: 'flex', alignItems: 'center', justifyContent: 'center',\n                  fontSize: '15px', fontWeight: '700', color: theme.colors.yellow,\n                }}>\n                  {val}\n                </div>\n              )))}\n            </div>\n          </div>\n\n          <div style={{ fontSize: '20px', color: theme.colors.textMuted }}>⊙</div>\n\n          {/* Kernel */}\n          <div style={{ background: theme.colors.surface, borderRadius: '10px', padding: '10px' }}>\n            <div style={{ fontSize: '10px', color: theme.colors.orange, marginBottom: '6px', textAlign: 'center' }}>Kernel</div>\n            <div style={{ display: 'grid', gridTemplateColumns: `repeat(${kW}, ${cellSize}px)`, gap: '3px' }}>\n              {kernel.map((row, r) => row.map((val, c) => (\n                <div key={`k-${r}-${c}`} style={{\n                  width: cellSize, height: cellSize, borderRadius: '5px',\n                  background: theme.colors.orange + '30',\n                  border: `2px solid ${theme.colors.orange}`,\n                  display: 'flex', alignItems: 'center', justifyContent: 'center',\n                  fontSize: '15px', fontWeight: '700', color: theme.colors.orange,\n                }}>\n                  {val}\n                </div>\n              )))}\n            </div>\n          </div>\n\n          <div style={{ fontSize: '20px', color: theme.colors.textMuted }}>=</div>\n\n          {/* Sum result */}\n          <div style={{ \n            width: cellSize * 2, height: cellSize * 1.5, borderRadius: '8px',\n            background: theme.colors.green + '30', border: `3px solid ${theme.colors.green}`,\n            display: 'flex', alignItems: 'center', justifyContent: 'center',\n            fontSize: '22px', fontWeight: '700', color: theme.colors.green,\n          }}>\n            {sum}\n          </div>\n        </div>\n\n        {/* Output */}\n        <div style={{ background: theme.colors.surface, borderRadius: '12px', padding: '14px' }}>\n          <div style={{ fontSize: '12px', color: theme.colors.green, marginBottom: '8px', fontWeight: '600' }}>\n            Output ({outH}×{outW})\n          </div>\n          <div style={{ display: 'grid', gridTemplateColumns: `repeat(${outW}, ${cellSize}px)`, gap: '3px' }}>\n            {output.map((row, r) => row.map((val, c) => {\n              const isSelected = r === kernelRow && c === kernelCol;\n              const isComputed = r < kernelRow || (r === kernelRow && c <= kernelCol);\n              return (\n                <div key={`o-${r}-${c}`}\n                  onClick={() => { setStep(r * outW + c); setPlaying(false); }}\n                  style={{\n                    width: cellSize, height: cellSize, borderRadius: '5px',\n                    background: isSelected ? theme.colors.green + '50' : (isComputed ? theme.colors.green + '20' : theme.colors.surfaceAlt),\n                    border: `3px solid ${isSelected ? theme.colors.green : (isComputed ? theme.colors.green + '50' : theme.colors.border)}`,\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\n                    fontSize: '13px', fontWeight: isSelected ? '700' : '500',\n                    color: isSelected ? theme.colors.green : (isComputed ? theme.colors.text : theme.colors.textMuted),\n                    cursor: 'pointer', transition: 'all 0.15s',\n                  }}>\n                  {isComputed ? val : '?'}\n                </div>\n              );\n            }))}\n          </div>\n        </div>\n      </div>\n\n      {/* Computation breakdown */}\n      <div style={{ background: theme.colors.surface, borderRadius: '10px', padding: '12px', marginTop: '12px' }}>\n        <div style={{ fontSize: '12px', color: theme.colors.yellow, fontWeight: '600', marginBottom: '10px' }}>\n          Computation: Σ (region ⊙ kernel)\n        </div>\n        \n        <div style={{ display: 'flex', alignItems: 'center', gap: '6px', flexWrap: 'wrap' }}>\n          {products.map((p, idx) => (\n            <React.Fragment key={idx}>\n              <div style={{ \n                padding: '6px 10px', background: theme.colors.surfaceAlt, borderRadius: '6px',\n                fontSize: '13px', display: 'flex', alignItems: 'center', gap: '4px'\n              }}>\n                <span style={{ color: theme.colors.yellow }}>{p.val}</span>\n                <span style={{ color: theme.colors.textMuted }}>×</span>\n                <span style={{ color: theme.colors.orange }}>{p.kVal}</span>\n                <span style={{ color: theme.colors.textMuted }}>=</span>\n                <span style={{ color: p.prod >= 0 ? theme.colors.green : theme.colors.red, fontWeight: '600' }}>{p.prod}</span>\n              </div>\n              {idx < products.length - 1 && <span style={{ color: theme.colors.textMuted, fontSize: '16px' }}>+</span>}\n            </React.Fragment>\n          ))}\n          <span style={{ color: theme.colors.textMuted, fontSize: '16px', marginLeft: '4px' }}>=</span>\n          <span style={{ color: theme.colors.green, fontWeight: '700', fontSize: '18px', marginLeft: '4px' }}>{sum}</span>\n        </div>\n      </div>\n\n      {/* Formula */}\n      <div style={{ marginTop: '10px', padding: '10px 12px', background: theme.colors.surfaceAlt, borderRadius: '8px',\n        fontSize: '12px', color: theme.colors.textSecondary }}>\n        <span style={{ color: theme.colors.primary, fontWeight: '600' }}>Output size: </span>\n        ⌊({inH} + 2×{padding} − {kH}) / {stride}⌋ + 1 = <span style={{ color: theme.colors.green, fontWeight: '600' }}>{outH}×{outW}</span>\n      </div>\n    </div>\n  );\n}",
  "settings": {
    "editorHeight": 600,
    "showPreview": true,
    "theme": "auto",
    "showEditor": false,
    "editorWidthPercentage": 35,
    "showConsole": false
  },
  "dependencies": {}
}