{
  "problem_id": 18,
  "title": "Implement K-Fold Cross-Validation",
  "category": "Machine Learning",
  "enabled": true,
  "type": "react",
  "code": "import React, { useState, useEffect } from 'react';\n\nconst theme = {\n  colors: {\n    primary: '#8b5cf6',\n    background: '#0a0a0a',\n    surface: '#111111',\n    surfaceAlt: '#1a1a1a',\n    border: '#2a2a2a',\n    text: '#fafafa',\n    textSecondary: '#a1a1aa',\n    textMuted: '#52525b',\n    positive: '#10b981',\n    negative: '#f43f5e',\n    blue: '#38bdf8',\n    yellow: '#fbbf24',\n    pink: '#f472b6',\n    green: '#a3e635',\n    orange: '#fb923c',\n  },\n  font: \"'JetBrains Mono', monospace\",\n};\n\nconst stepInfo = [\n  {\n    title: 'Understanding K-Fold Cross-Validation',\n    desc: 'K-Fold CV splits your data into K equal parts (folds). Each fold takes a turn being the test set while the others form the training set. This gives K different train/test splits.',\n    color: theme.colors.primary,\n  },\n  {\n    title: 'Step 1: Divide Data into K Folds',\n    desc: 'The dataset is split into K roughly equal groups. With shuffle on, data is randomized first. Each group will serve as the test set exactly once.',\n    color: theme.colors.blue,\n  },\n  {\n    title: 'Step 2: First Fold as Test Set',\n    desc: 'Fold 1 becomes the test set (pink). All other folds combine to form the training set (green). We train on green, evaluate on pink.',\n    color: theme.colors.pink,\n  },\n  {\n    title: 'Step 3: Rotate Test Set',\n    desc: 'Now Fold 2 is the test set. This rotation continues until every fold has been the test set exactly once. Watch the test set move!',\n    color: theme.colors.pink,\n  },\n  {\n    title: 'Complete: All Folds Evaluated',\n    desc: 'Every sample was in the test set exactly once and in training K-1 times. Average the K scores for a robust performance estimate.',\n    color: theme.colors.positive,\n  },\n];\n\nexport default function App() {\n  const [k, setK] = useState(5);\n  const [shuffle, setShuffle] = useState(false);\n  const [step, setStep] = useState(0);\n  const [currentFold, setCurrentFold] = useState(0);\n  const [playing, setPlaying] = useState(false);\n  const [indices, setIndices] = useState([]);\n  const [folds, setFolds] = useState([]);\n\n  const nSamples = 10;\n  const totalSteps = 4;\n\n  // Shuffle function with seed for reproducibility\n  const shuffleArray = (arr) => {\n    const shuffled = [...arr];\n    // Simple Fisher-Yates with deterministic seed simulation\n    for (let i = shuffled.length - 1; i > 0; i--) {\n      const j = Math.floor((Math.sin(i * 9999) * 0.5 + 0.5) * (i + 1));\n      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n    }\n    return shuffled;\n  };\n\n  // Create folds when k or shuffle changes\n  useEffect(() => {\n    let idx = Array.from({ length: nSamples }, (_, i) => i);\n    if (shuffle) {\n      idx = shuffleArray(idx);\n    }\n    setIndices(idx);\n\n    // Split into k folds\n    const foldSize = Math.floor(nSamples / k);\n    const extras = nSamples % k;\n    const newFolds = [];\n    let start = 0;\n    for (let i = 0; i < k; i++) {\n      const size = foldSize + (i < extras ? 1 : 0);\n      newFolds.push(idx.slice(start, start + size));\n      start += size;\n    }\n    setFolds(newFolds);\n    setStep(0);\n    setCurrentFold(0);\n  }, [k, shuffle]);\n\n  const reset = () => {\n    setStep(0);\n    setCurrentFold(0);\n    setPlaying(false);\n  };\n\n  const next = () => {\n    if (step === 0) {\n      setStep(1);\n    } else if (step === 1) {\n      setStep(2);\n      setCurrentFold(0);\n    } else if (step === 2 || step === 3) {\n      if (currentFold < k - 1) {\n        setCurrentFold(currentFold + 1);\n        setStep(3);\n      } else {\n        setStep(4);\n      }\n    }\n  };\n\n  const prev = () => {\n    if (step === 4) {\n      setStep(3);\n      setCurrentFold(k - 1);\n    } else if (step === 3) {\n      if (currentFold > 0) {\n        setCurrentFold(currentFold - 1);\n      } else {\n        setStep(2);\n      }\n    } else if (step > 0) {\n      setStep(step - 1);\n    }\n  };\n\n  const auto = async () => {\n    setPlaying(true);\n    \n    // Step through\n    setStep(1);\n    await new Promise(r => setTimeout(r, 1000));\n    \n    setStep(2);\n    setCurrentFold(0);\n    await new Promise(r => setTimeout(r, 1000));\n    \n    for (let f = 1; f < k; f++) {\n      setCurrentFold(f);\n      setStep(3);\n      await new Promise(r => setTimeout(r, 800));\n    }\n    \n    setStep(4);\n    setPlaying(false);\n  };\n\n  // Get train/test indices for current fold\n  const getTrainTest = () => {\n    if (step < 2 || folds.length === 0) return { train: [], test: [] };\n    const test = folds[currentFold] || [];\n    const train = folds.filter((_, i) => i !== currentFold).flat();\n    return { train, test };\n  };\n\n  const { train, test } = getTrainTest();\n\n  // Determine which fold a sample belongs to\n  const getSampleFold = (sampleIdx) => {\n    for (let f = 0; f < folds.length; f++) {\n      if (folds[f].includes(sampleIdx)) return f;\n    }\n    return -1;\n  };\n\n  // Get display info for step\n  const getStepDisplay = () => {\n    if (step < 2) return stepInfo[step];\n    if (step === 2) return stepInfo[2];\n    if (step === 3) return { ...stepInfo[3], title: `Fold ${currentFold + 1} as Test Set` };\n    return stepInfo[4];\n  };\n\n  const displayStep = getStepDisplay();\n\n  return (\n    <div style={{\n      background: theme.colors.background,\n      padding: '16px',\n      fontFamily: theme.font,\n      color: theme.colors.text,\n      minHeight: '100vh',\n      boxSizing: 'border-box',\n    }}>\n      {/* Header */}\n      <div style={{ textAlign: 'center', marginBottom: '12px' }}>\n        <div style={{ fontSize: '18px', fontWeight: '700' }}>\n          K-Fold Cross-Validation\n        </div>\n        <div style={{ fontSize: '11px', color: theme.colors.textSecondary }}>\n          See how data rotates through train and test sets\n        </div>\n      </div>\n\n      {/* Controls for K and Shuffle */}\n      <div style={{ \n        display: 'flex', \n        gap: '12px', \n        justifyContent: 'center', \n        marginBottom: '16px',\n        flexWrap: 'wrap',\n      }}>\n        <div style={{\n          display: 'flex',\n          alignItems: 'center',\n          gap: '8px',\n          padding: '8px 12px',\n          background: theme.colors.surface,\n          borderRadius: '8px',\n        }}>\n          <span style={{ fontSize: '11px', color: theme.colors.textSecondary }}>K =</span>\n          {[2, 3, 5].map(kVal => (\n            <button\n              key={kVal}\n              onClick={() => setK(kVal)}\n              style={{\n                padding: '4px 10px',\n                background: k === kVal ? theme.colors.primary : theme.colors.surfaceAlt,\n                border: 'none',\n                borderRadius: '4px',\n                color: k === kVal ? '#fff' : theme.colors.textSecondary,\n                fontFamily: theme.font,\n                fontSize: '12px',\n                cursor: 'pointer',\n              }}\n            >\n              {kVal}\n            </button>\n          ))}\n        </div>\n\n        <button\n          onClick={() => setShuffle(!shuffle)}\n          style={{\n            padding: '8px 14px',\n            background: shuffle ? theme.colors.primary : theme.colors.surface,\n            border: 'none',\n            borderRadius: '8px',\n            color: shuffle ? '#fff' : theme.colors.textSecondary,\n            fontFamily: theme.font,\n            fontSize: '11px',\n            cursor: 'pointer',\n          }}\n        >\n          Shuffle: {shuffle ? 'ON' : 'OFF'}\n        </button>\n      </div>\n\n      {/* Main Visualization */}\n      <div style={{\n        background: theme.colors.surface,\n        borderRadius: '12px',\n        padding: '16px',\n        marginBottom: '12px',\n      }}>\n        {/* Fold Labels */}\n        {step >= 1 && (\n          <div style={{ \n            display: 'flex', \n            justifyContent: 'center', \n            gap: '4px', \n            marginBottom: '8px',\n            flexWrap: 'wrap',\n          }}>\n            {folds.map((fold, fi) => (\n              <div\n                key={fi}\n                style={{\n                  padding: '4px 8px',\n                  background: step >= 2 && fi === currentFold ? theme.colors.pink + '30' : theme.colors.surfaceAlt,\n                  borderRadius: '4px',\n                  border: `2px solid ${step >= 2 && fi === currentFold ? theme.colors.pink : theme.colors.border}`,\n                  fontSize: '10px',\n                  color: step >= 2 && fi === currentFold ? theme.colors.pink : theme.colors.textSecondary,\n                }}\n              >\n                Fold {fi + 1} ({fold.length})\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Sample Grid */}\n        <div style={{\n          display: 'flex',\n          flexWrap: 'wrap',\n          gap: '6px',\n          justifyContent: 'center',\n          padding: '12px',\n        }}>\n          {indices.map((sampleIdx, pos) => {\n            const foldIdx = getSampleFold(sampleIdx);\n            let bgColor = theme.colors.surfaceAlt;\n            let borderColor = theme.colors.border;\n            let textColor = theme.colors.text;\n\n            if (step >= 1) {\n              // Color by fold\n              const foldColors = ['#f472b6', '#38bdf8', '#a3e635', '#fbbf24', '#fb923c'];\n              borderColor = foldColors[foldIdx % foldColors.length];\n            }\n\n            if (step >= 2) {\n              // Color by train/test\n              if (test.includes(sampleIdx)) {\n                bgColor = theme.colors.pink;\n                borderColor = theme.colors.pink;\n                textColor = '#000';\n              } else if (train.includes(sampleIdx)) {\n                bgColor = theme.colors.green;\n                borderColor = theme.colors.green;\n                textColor = '#000';\n              }\n            }\n\n            return (\n              <div\n                key={pos}\n                style={{\n                  width: '36px',\n                  height: '36px',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  background: bgColor,\n                  border: `2px solid ${borderColor}`,\n                  borderRadius: '6px',\n                  fontSize: '12px',\n                  fontWeight: '600',\n                  color: textColor,\n                  transition: 'all 0.3s',\n                }}\n              >\n                {sampleIdx}\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Legend */}\n        {step >= 2 && (\n          <div style={{\n            display: 'flex',\n            justifyContent: 'center',\n            gap: '16px',\n            marginTop: '12px',\n          }}>\n            <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\n              <div style={{\n                width: '16px',\n                height: '16px',\n                background: theme.colors.green,\n                borderRadius: '4px',\n              }} />\n              <span style={{ fontSize: '10px', color: theme.colors.textSecondary }}>\n                Train ({train.length} samples)\n              </span>\n            </div>\n            <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\n              <div style={{\n                width: '16px',\n                height: '16px',\n                background: theme.colors.pink,\n                borderRadius: '4px',\n              }} />\n              <span style={{ fontSize: '10px', color: theme.colors.textSecondary }}>\n                Test ({test.length} samples)\n              </span>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Fold Iteration Indicator */}\n      {step >= 2 && (\n        <div style={{\n          display: 'flex',\n          justifyContent: 'center',\n          gap: '6px',\n          marginBottom: '12px',\n        }}>\n          {Array.from({ length: k }).map((_, i) => (\n            <div\n              key={i}\n              style={{\n                width: i === currentFold ? '24px' : '12px',\n                height: '12px',\n                borderRadius: '6px',\n                background: i <= currentFold ? theme.colors.pink : theme.colors.border,\n                transition: 'all 0.3s',\n              }}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* Step Explanation */}\n      <div style={{\n        padding: '10px 12px',\n        background: theme.colors.surface,\n        borderRadius: '8px',\n        borderLeft: `3px solid ${displayStep.color}`,\n        marginBottom: '12px',\n      }}>\n        <div style={{ fontSize: '12px', fontWeight: '600', color: theme.colors.text }}>\n          {displayStep.title}\n        </div>\n        <div style={{ fontSize: '11px', color: theme.colors.textSecondary, lineHeight: 1.5 }}>\n          {displayStep.desc}\n        </div>\n      </div>\n\n      {/* Step Dots */}\n      <div style={{ display: 'flex', gap: '4px', justifyContent: 'center', marginBottom: '12px' }}>\n        {Array.from({ length: totalSteps + 1 }).map((_, i) => (\n          <div\n            key={i}\n            style={{\n              width: i === step || (step >= 2 && step <= 3 && i === 2) ? '20px' : '8px',\n              height: '8px',\n              borderRadius: '4px',\n              background: i <= step ? theme.colors.primary : theme.colors.border,\n              transition: 'all 0.3s',\n            }}\n          />\n        ))}\n      </div>\n\n      {/* Controls */}\n      <div style={{ display: 'flex', gap: '8px', alignItems: 'center', marginBottom: '12px' }}>\n        <button\n          onClick={prev}\n          disabled={step <= 0 || playing}\n          style={{\n            padding: '8px 12px',\n            background: step <= 0 ? theme.colors.border : theme.colors.surface,\n            border: 'none',\n            borderRadius: '6px',\n            color: step <= 0 ? theme.colors.textMuted : theme.colors.text,\n            fontFamily: theme.font,\n            fontSize: '14px',\n            cursor: step <= 0 ? 'not-allowed' : 'pointer',\n          }}\n        >\n          {'<'}\n        </button>\n        <button\n          onClick={next}\n          disabled={step >= totalSteps || playing}\n          style={{\n            flex: 1,\n            padding: '10px 16px',\n            background: theme.colors.primary,\n            border: 'none',\n            borderRadius: '6px',\n            color: '#fff',\n            fontFamily: theme.font,\n            fontSize: '12px',\n            fontWeight: '600',\n            cursor: step >= totalSteps ? 'not-allowed' : 'pointer',\n            opacity: step >= totalSteps ? 0.5 : 1,\n          }}\n        >\n          {step === 0 ? 'Start' : step >= totalSteps ? 'Complete!' : \n           step >= 2 && currentFold < k - 1 ? `Next Fold (${currentFold + 2}/${k})` : 'Next Step'}\n        </button>\n        <button\n          onClick={auto}\n          disabled={playing || step >= totalSteps}\n          style={{\n            padding: '8px 12px',\n            background: playing ? theme.colors.border : theme.colors.surface,\n            border: 'none',\n            borderRadius: '6px',\n            color: playing ? theme.colors.textMuted : theme.colors.text,\n            fontFamily: theme.font,\n            fontSize: '14px',\n            cursor: playing ? 'not-allowed' : 'pointer',\n          }}\n        >\n          {playing ? '...' : '>>'}\n        </button>\n        <button\n          onClick={reset}\n          style={{\n            padding: '8px 12px',\n            background: theme.colors.surface,\n            border: 'none',\n            borderRadius: '6px',\n            color: theme.colors.text,\n            fontFamily: theme.font,\n            fontSize: '14px',\n            cursor: 'pointer',\n          }}\n        >\n          {'~'}\n        </button>\n      </div>\n\n      {/* Index Details */}\n      {step >= 2 && (\n        <div style={{\n          padding: '10px',\n          background: theme.colors.surfaceAlt,\n          borderRadius: '8px',\n          marginBottom: '12px',\n        }}>\n          <div style={{ fontSize: '11px', color: theme.colors.textSecondary, marginBottom: '8px' }}>\n            Iteration {currentFold + 1} of {k}:\n          </div>\n          <div style={{ marginBottom: '6px' }}>\n            <span style={{ fontSize: '10px', color: theme.colors.green, fontWeight: '600' }}>\n              Train indices: \n            </span>\n            <span style={{ fontSize: '10px', color: theme.colors.textSecondary, marginLeft: '4px' }}>\n              [{train.join(', ')}]\n            </span>\n          </div>\n          <div>\n            <span style={{ fontSize: '10px', color: theme.colors.pink, fontWeight: '600' }}>\n              Test indices: \n            </span>\n            <span style={{ fontSize: '10px', color: theme.colors.textSecondary, marginLeft: '4px' }}>\n              [{test.join(', ')}]\n            </span>\n          </div>\n        </div>\n      )}\n\n      {/* Summary at end */}\n      {step === 4 && (\n        <div style={{\n          padding: '10px',\n          background: theme.colors.positive + '20',\n          borderRadius: '8px',\n          border: `1px solid ${theme.colors.positive}`,\n          marginBottom: '12px',\n        }}>\n          <div style={{ fontSize: '11px', color: theme.colors.positive, fontWeight: '600', marginBottom: '4px' }}>\n            K-Fold Complete!\n          </div>\n          <div style={{ fontSize: '10px', color: theme.colors.textSecondary }}>\n            Each sample appeared in the test set exactly once across {k} iterations.\n            In practice, you would train a model {k} times and average the scores.\n          </div>\n        </div>\n      )}\n\n      {/* Key Insight */}\n      <div style={{\n        padding: '10px 14px',\n        background: theme.colors.surface,\n        borderRadius: '8px',\n        fontSize: '10px',\n        color: theme.colors.textSecondary,\n        textAlign: 'center',\n      }}>\n        <strong style={{ color: theme.colors.text }}>Key insight:</strong>{' '}\n        K-Fold ensures every data point is tested exactly once, giving a more reliable performance estimate than a single train-test split.\n      </div>\n    </div>\n  );\n}\n",
  "settings": {
    "editorHeight": 600,
    "showPreview": true,
    "theme": "auto",
    "showEditor": false,
    "editorWidthPercentage": 35,
    "showConsole": false
  },
  "dependencies": {}
}