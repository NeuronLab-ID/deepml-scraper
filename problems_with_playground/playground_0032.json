{
  "problem_id": 32,
  "title": "Generate Sorted Polynomial Features",
  "category": "Machine Learning",
  "enabled": true,
  "type": "react",
  "code": "import React, { useState, useMemo } from 'react';\n\nconst theme = {\n  colors: {\n    primary: '#8b5cf6',\n    background: '#0a0a0a',\n    surface: '#111111',\n    surfaceAlt: '#1a1a1a',\n    border: '#2a2a2a',\n    text: '#fafafa',\n    textSecondary: '#a1a1aa',\n    textMuted: '#52525b',\n    blue: '#38bdf8',\n    yellow: '#fbbf24',\n    pink: '#f472b6',\n    green: '#a3e635',\n    orange: '#fb923c',\n  },\n  font: \"'JetBrains Mono', monospace\",\n};\n\n// Generate combinations with replacement\nconst combsWithReplacement = (arr, r) => {\n  if (r === 0) return [[]];\n  if (arr.length === 0) return [];\n  const result = [];\n  const helper = (start, combo) => {\n    if (combo.length === r) { result.push([...combo]); return; }\n    for (let i = start; i < arr.length; i++) {\n      combo.push(arr[i]);\n      helper(i, combo);\n      combo.pop();\n    }\n  };\n  helper(0, []);\n  return result;\n};\n\nexport default function App() {\n  const [step, setStep] = useState(0);\n  const [playing, setPlaying] = useState(false);\n  const [degree, setDegree] = useState(2);\n  const [selectedSample, setSelectedSample] = useState(0);\n\n  const numSteps = 4;\n\n  // Sample data for polynomial expansion\n  const X = [[2, 3], [3, 4], [5, 6]];\n  const featureNames = ['x₁', 'x₂'];\n\n  // Data for curve fitting demo (1D)\n  const curvePoints = [\n    { x: 1, y: 1 },\n    { x: 2, y: 4 },\n    { x: 3, y: 2 },\n    { x: 4, y: 5 },\n    { x: 5, y: 4 },\n  ];\n\n  // Generate polynomial features\n  const { terms, values, sorted } = useMemo(() => {\n    const n_features = X[0].length;\n    const featureIndices = Array.from({ length: n_features }, (_, i) => i);\n    \n    const allCombs = [];\n    for (let d = 0; d <= degree; d++) {\n      if (d === 0) {\n        allCombs.push({ indices: [], label: '1', degree: 0 });\n      } else {\n        const combs = combsWithReplacement(featureIndices, d);\n        combs.forEach(c => {\n          const counts = {};\n          c.forEach(i => { counts[i] = (counts[i] || 0) + 1; });\n          let label = Object.entries(counts)\n            .map(([idx, count]) => featureNames[idx] + (count > 1 ? `^${count}` : ''))\n            .join('·');\n          allCombs.push({ indices: c, label, degree: d });\n        });\n      }\n    }\n\n    const values = X.map(sample => {\n      return allCombs.map(term => {\n        if (term.indices.length === 0) return 1;\n        return term.indices.reduce((prod, idx) => prod * sample[idx], 1);\n      });\n    });\n\n    const sorted = values.map(row => [...row].sort((a, b) => a - b));\n\n    return { terms: allCombs, values, sorted };\n  }, [degree]);\n\n  // Fit polynomial curve (least squares approximation for demo)\n  const curvePath = useMemo(() => {\n    // Simple polynomial fit using the points\n    const n = curvePoints.length;\n    const xs = curvePoints.map(p => p.x);\n    const ys = curvePoints.map(p => p.y);\n    \n    // Generate path points\n    const pathPoints = [];\n    for (let px = 0.5; px <= 5.5; px += 0.1) {\n      // Lagrange interpolation for smooth curve (simplified for demo)\n      let y = 0;\n      if (degree === 1) {\n        // Linear: just connect first and last\n        const slope = (ys[n-1] - ys[0]) / (xs[n-1] - xs[0]);\n        y = ys[0] + slope * (px - xs[0]);\n      } else if (degree === 2) {\n        // Quadratic approximation\n        y = 0.5 + 2.5 * px - 0.3 * px * px;\n      } else {\n        // Cubic - more wiggly\n        y = -2 + 4.5 * px - 1.2 * px * px + 0.1 * px * px * px;\n      }\n      pathPoints.push({ x: px, y: Math.max(0, Math.min(6, y)) });\n    }\n    return pathPoints;\n  }, [degree]);\n\n  const stepInfo = [\n    { title: 'Original Data', desc: `${X.length} samples × ${X[0].length} features`, color: theme.colors.primary },\n    { title: 'Polynomial Terms', desc: `degree=${degree} → ${terms.length} features`, color: theme.colors.blue },\n    { title: 'Compute Values', desc: 'Evaluate each term for each sample', color: theme.colors.yellow },\n    { title: 'Sort Each Row', desc: 'Order values ascending per sample', color: theme.colors.green },\n  ];\n\n  const play = async () => {\n    setPlaying(true);\n    for (let s = 0; s < numSteps; s++) {\n      setStep(s);\n      await new Promise(r => setTimeout(r, 2000));\n    }\n    setPlaying(false);\n  };\n\n  const reset = () => { setStep(0); setPlaying(false); setDegree(2); setSelectedSample(0); };\n\n  // SVG for curve graph\n  const graphW = 280, graphH = 180;\n  const pad = 35;\n  const toGraph = (x, y) => [\n    pad + ((x - 0.5) / 5.5) * (graphW - 2 * pad),\n    graphH - pad - ((y - 0) / 6) * (graphH - 2 * pad)\n  ];\n\n  return (\n    <div style={{ background: theme.colors.background, minHeight: '100vh', padding: '12px', fontFamily: theme.font, color: theme.colors.text }}>\n      \n      {/* Header */}\n      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '8px' }}>\n        <div>\n          <div style={{ fontSize: '18px', fontWeight: '700' }}>Polynomial Features</div>\n          <div style={{ fontSize: '12px', color: theme.colors.textSecondary }}>Expand features for non-linear modeling</div>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\n          <button onClick={() => setStep(Math.max(0, step - 1))} disabled={step === 0}\n            style={{ padding: '6px 12px', background: theme.colors.surface, border: 'none', borderRadius: '6px',\n              color: step === 0 ? theme.colors.textMuted : theme.colors.text, fontSize: '14px', cursor: 'pointer' }}>{'<'}</button>\n          <div style={{ display: 'flex', gap: '5px' }}>\n            {Array.from({ length: numSteps }, (_, i) => (\n              <div key={i} onClick={() => setStep(i)} style={{\n                width: i === step ? '18px' : '10px', height: '10px', borderRadius: '5px',\n                background: i <= step ? stepInfo[i].color : theme.colors.border, cursor: 'pointer'\n              }} />\n            ))}\n          </div>\n          <button onClick={() => setStep(Math.min(numSteps - 1, step + 1))} disabled={step === numSteps - 1}\n            style={{ padding: '6px 12px', background: step === numSteps - 1 ? theme.colors.surface : theme.colors.primary,\n              border: 'none', borderRadius: '6px', color: theme.colors.text, fontSize: '14px', cursor: 'pointer' }}>{'>'}</button>\n          <button onClick={play} disabled={playing}\n            style={{ padding: '6px 12px', background: playing ? theme.colors.green : theme.colors.surface,\n              border: 'none', borderRadius: '6px', color: playing ? theme.colors.background : theme.colors.text,\n              fontSize: '12px', cursor: 'pointer' }}>{playing ? '...' : 'Play'}</button>\n          <button onClick={reset}\n            style={{ padding: '6px 10px', background: theme.colors.surface, border: 'none', borderRadius: '6px',\n              color: theme.colors.textSecondary, fontSize: '14px', cursor: 'pointer' }}>~</button>\n        </div>\n      </div>\n\n      {/* Step info */}\n      <div style={{ padding: '8px 12px', background: theme.colors.surface, borderLeft: `3px solid ${stepInfo[step].color}`,\n        borderRadius: '0 6px 6px 0', marginBottom: '10px' }}>\n        <span style={{ fontWeight: '600', color: stepInfo[step].color, fontSize: '14px' }}>{stepInfo[step].title}: </span>\n        <span style={{ color: theme.colors.textSecondary, fontSize: '13px' }}>{stepInfo[step].desc}</span>\n      </div>\n\n      <div style={{ display: 'flex', gap: '12px', marginBottom: '10px' }}>\n        \n        {/* Left: Graph + Degree control */}\n        <div style={{ width: '300px', display: 'flex', flexDirection: 'column', gap: '10px' }}>\n          \n          {/* Curve fitting graph */}\n          <div style={{ background: theme.colors.surface, borderRadius: '8px', padding: '10px' }}>\n            <div style={{ fontSize: '11px', color: theme.colors.textMuted, marginBottom: '6px' }}>\n              Why polynomial features? → Fit curves!\n            </div>\n            <svg viewBox={`0 0 ${graphW} ${graphH}`} style={{ width: '100%', height: '180px' }}>\n              <rect x=\"0\" y=\"0\" width={graphW} height={graphH} fill={theme.colors.surfaceAlt} rx=\"6\" />\n              \n              {/* Grid */}\n              {[1, 2, 3, 4, 5].map(v => {\n                const [x] = toGraph(v, 0);\n                return <line key={v} x1={x} y1={pad} x2={x} y2={graphH - pad} stroke={theme.colors.border} strokeWidth=\"1\" />;\n              })}\n              {[1, 2, 3, 4, 5].map(v => {\n                const [, y] = toGraph(0, v);\n                return <line key={v} x1={pad} y1={y} x2={graphW - pad} y2={y} stroke={theme.colors.border} strokeWidth=\"1\" />;\n              })}\n\n              {/* Polynomial curve */}\n              <path\n                d={curvePath.map((p, i) => {\n                  const [x, y] = toGraph(p.x, p.y);\n                  return (i === 0 ? 'M' : 'L') + `${x},${y}`;\n                }).join(' ')}\n                fill=\"none\"\n                stroke={degree === 1 ? theme.colors.blue : degree === 2 ? theme.colors.yellow : theme.colors.pink}\n                strokeWidth=\"3\"\n              />\n\n              {/* Data points */}\n              {curvePoints.map((p, i) => {\n                const [cx, cy] = toGraph(p.x, p.y);\n                return (\n                  <circle key={i} cx={cx} cy={cy} r=\"8\" fill={theme.colors.green} stroke={theme.colors.background} strokeWidth=\"2\" />\n                );\n              })}\n\n              {/* Labels */}\n              <text x={graphW / 2} y={graphH - 8} textAnchor=\"middle\" fill={theme.colors.textMuted} fontSize=\"11\">x</text>\n              <text x=\"10\" y={graphH / 2} textAnchor=\"middle\" fill={theme.colors.textMuted} fontSize=\"11\" transform={`rotate(-90, 10, ${graphH/2})`}>y</text>\n              \n              {/* Degree label */}\n              <text x={graphW - 10} y=\"20\" textAnchor=\"end\" fill={degree === 1 ? theme.colors.blue : degree === 2 ? theme.colors.yellow : theme.colors.pink} fontSize=\"12\" fontWeight=\"bold\">\n                degree {degree}\n              </text>\n            </svg>\n            <div style={{ fontSize: '10px', color: theme.colors.textMuted, textAlign: 'center', marginTop: '4px' }}>\n              Higher degree → more flexible curve\n            </div>\n          </div>\n\n          {/* Degree control */}\n          <div style={{ background: theme.colors.surface, borderRadius: '8px', padding: '12px',\n            border: step === 1 ? `2px solid ${theme.colors.blue}` : `1px solid ${theme.colors.border}` }}>\n            <div style={{ fontSize: '12px', color: theme.colors.textMuted, marginBottom: '8px' }}>degree</div>\n            <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\n              <input type=\"range\" min={1} max={3} value={degree} onChange={e => setDegree(+e.target.value)}\n                style={{ flex: 1, accentColor: theme.colors.blue }} />\n              <span style={{ fontSize: '20px', color: theme.colors.blue, fontWeight: '700', width: '24px' }}>{degree}</span>\n            </div>\n            <div style={{ fontSize: '11px', color: theme.colors.textMuted, marginTop: '6px' }}>\n              2 features → {terms.length} polynomial terms\n            </div>\n          </div>\n\n          {/* Terms by degree */}\n          <div style={{ background: theme.colors.surface, borderRadius: '8px', padding: '10px' }}>\n            <div style={{ fontSize: '11px', color: theme.colors.textMuted, marginBottom: '6px' }}>Terms created:</div>\n            <div style={{ fontSize: '12px', color: theme.colors.textSecondary, lineHeight: 1.6 }}>\n              <div><span style={{ color: theme.colors.blue }}>d=0:</span> 1</div>\n              <div><span style={{ color: theme.colors.blue }}>d=1:</span> x₁, x₂</div>\n              {degree >= 2 && <div><span style={{ color: theme.colors.yellow }}>d=2:</span> x₁², x₁·x₂, x₂²</div>}\n              {degree >= 3 && <div><span style={{ color: theme.colors.pink }}>d=3:</span> x₁³, x₁²·x₂, x₁·x₂², x₂³</div>}\n            </div>\n          </div>\n        </div>\n\n        {/* Right: Data & computation */}\n        <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '10px' }}>\n          \n          {/* Original data */}\n          <div style={{ background: theme.colors.surface, borderRadius: '8px', padding: '10px' }}>\n            <div style={{ fontSize: '11px', color: theme.colors.textMuted, marginBottom: '6px' }}>\n              Input X (click to select)\n            </div>\n            <div style={{ display: 'flex', gap: '8px' }}>\n              {X.map((row, i) => (\n                <div key={i} onClick={() => setSelectedSample(i)}\n                  style={{\n                    padding: '8px 12px', borderRadius: '6px', cursor: 'pointer', flex: 1,\n                    background: selectedSample === i ? theme.colors.primary + '30' : theme.colors.surfaceAlt,\n                    border: `2px solid ${selectedSample === i ? theme.colors.primary : 'transparent'}`,\n                  }}>\n                  <div style={{ fontSize: '10px', color: theme.colors.textMuted }}>Sample {i}</div>\n                  <div style={{ fontSize: '14px', fontWeight: '600' }}>\n                    [{row.join(', ')}]\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Polynomial expansion for selected sample */}\n          <div style={{ background: theme.colors.surface, borderRadius: '8px', padding: '10px' }}>\n            <div style={{ fontSize: '11px', color: theme.colors.textMuted, marginBottom: '8px' }}>\n              Sample {selectedSample}: x₁=<span style={{ color: theme.colors.blue }}>{X[selectedSample][0]}</span>, x₂=<span style={{ color: theme.colors.pink }}>{X[selectedSample][1]}</span>\n            </div>\n            \n            {/* Terms with values */}\n            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px', marginBottom: '10px' }}>\n              {terms.map((term, i) => {\n                const val = values[selectedSample][i];\n                return (\n                  <div key={i} style={{\n                    padding: '6px 10px', borderRadius: '6px',\n                    background: term.degree === 0 ? theme.colors.surfaceAlt : \n                               term.degree === 1 ? theme.colors.blue + '15' :\n                               term.degree === 2 ? theme.colors.yellow + '15' : theme.colors.pink + '15',\n                    border: `1px solid ${term.degree === 0 ? theme.colors.border : \n                            term.degree === 1 ? theme.colors.blue + '40' :\n                            term.degree === 2 ? theme.colors.yellow + '40' : theme.colors.pink + '40'}`,\n                  }}>\n                    <div style={{ fontSize: '12px', color: theme.colors.text, fontWeight: '600' }}>\n                      {term.label}\n                    </div>\n                    {step >= 2 && (\n                      <div style={{ fontSize: '13px', color: theme.colors.green, fontWeight: '700' }}>\n                        = {val}\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Raw → Sorted */}\n            {step >= 2 && (\n              <div style={{ display: 'flex', gap: '12px' }}>\n                <div style={{ flex: 1 }}>\n                  <div style={{ fontSize: '10px', color: theme.colors.yellow, marginBottom: '4px' }}>Raw values:</div>\n                  <div style={{ fontSize: '12px', color: theme.colors.yellow, fontWeight: '600' }}>\n                    [{values[selectedSample].join(', ')}]\n                  </div>\n                </div>\n                {step >= 3 && (\n                  <div style={{ flex: 1 }}>\n                    <div style={{ fontSize: '10px', color: theme.colors.green, marginBottom: '4px' }}>Sorted ↑:</div>\n                    <div style={{ fontSize: '12px', color: theme.colors.green, fontWeight: '600' }}>\n                      [{sorted[selectedSample].join(', ')}]\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* Full output */}\n          {step >= 3 && (\n            <div style={{ background: theme.colors.green + '15', borderRadius: '8px', padding: '10px',\n              border: `2px solid ${theme.colors.green}` }}>\n              <div style={{ fontSize: '11px', color: theme.colors.green, fontWeight: '600', marginBottom: '6px' }}>\n                Output: {X.length} × {terms.length} matrix (sorted rows)\n              </div>\n              <div style={{ fontSize: '11px', color: theme.colors.textSecondary, fontFamily: theme.font }}>\n                {sorted.map((row, i) => (\n                  <div key={i} style={{ marginBottom: '2px' }}>\n                    [{row.join(', ')}]\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Key Insight */}\n      <div style={{ background: theme.colors.surfaceAlt, borderRadius: '8px', padding: '10px 14px',\n        fontSize: '12px', color: theme.colors.textSecondary, borderLeft: `3px solid ${theme.colors.primary}` }}>\n        <span style={{ color: theme.colors.primary, fontWeight: '600' }}>Key: </span>\n        {step === 0 && 'Linear models can only fit straight lines. Polynomial features let them fit curves by adding x², x³, x₁·x₂, etc.'}\n        {step === 1 && `degree=${degree} creates all combinations: 1, x₁, x₂, x₁², x₁x₂, x₂². Watch the curve in the graph become more flexible!`}\n        {step === 2 && `Each term evaluated: 1=1, x₁=${X[selectedSample][0]}, x₁²=${X[selectedSample][0]**2}, x₁·x₂=${X[selectedSample][0]*X[selectedSample][1]}, ...`}\n        {step === 3 && 'Final output is sorted per row. This transforms 2 features → ' + terms.length + ' polynomial features!'}\n      </div>\n    </div>\n  );\n}",
  "settings": {
    "editorHeight": 600,
    "showPreview": true,
    "theme": "auto",
    "showEditor": false,
    "editorWidthPercentage": 35,
    "showConsole": false
  },
  "dependencies": {}
}