{
  "problem_id": 14,
  "title": "Linear Regression Using Normal Equation",
  "category": "Machine Learning",
  "enabled": true,
  "type": "react",
  "code": "import React, { useState, useMemo, useRef, useEffect } from 'react';\n\n// ============================================\n// Design Tokens\n// ============================================\nconst theme = {\n  colors: {\n    primary: '#8b5cf6',\n    background: '#0a0a0a',\n    surface: '#111111',\n    surfaceAlt: '#1a1a1a',\n    border: '#2a2a2a',\n    text: '#fafafa',\n    textSecondary: '#a1a1aa',\n    textMuted: '#52525b',\n    positive: '#10b981',\n    negative: '#f43f5e',\n    blue: '#38bdf8',\n    yellow: '#fbbf24',\n    pink: '#f472b6',\n    green: '#a3e635',\n    orange: '#fb923c',\n  },\n  font: \"'JetBrains Mono', monospace\",\n};\n\n// ============================================\n// Linear Regression Calculation\n// ============================================\nfunction computeRegression(X, y) {\n  const m = X.length;\n  const n = X[0].length;\n  \n  const Xt = [];\n  for (let j = 0; j < n; j++) {\n    Xt.push(X.map(row => row[j]));\n  }\n  \n  const XtX = [];\n  for (let i = 0; i < n; i++) {\n    XtX.push([]);\n    for (let j = 0; j < n; j++) {\n      let sum = 0;\n      for (let k = 0; k < m; k++) {\n        sum += Xt[i][k] * X[k][j];\n      }\n      XtX[i].push(sum);\n    }\n  }\n  \n  const Xty = [];\n  for (let i = 0; i < n; i++) {\n    let sum = 0;\n    for (let k = 0; k < m; k++) {\n      sum += Xt[i][k] * y[k];\n    }\n    Xty.push(sum);\n  }\n  \n  const det = XtX[0][0] * XtX[1][1] - XtX[0][1] * XtX[1][0];\n  const XtXinv = [\n    [XtX[1][1] / det, -XtX[0][1] / det],\n    [-XtX[1][0] / det, XtX[0][0] / det]\n  ];\n  \n  const theta = [];\n  for (let i = 0; i < n; i++) {\n    let sum = 0;\n    for (let j = 0; j < n; j++) {\n      sum += XtXinv[i][j] * Xty[j];\n    }\n    theta.push(Math.round(sum * 10000) / 10000);\n  }\n  \n  return { Xt, XtX, Xty, XtXinv, theta, det };\n}\n\n// ============================================\n// Scatter Plot with Regression Line\n// ============================================\nfunction RegressionPlot({ points, theta, step }) {\n  const canvasRef = useRef(null);\n  const size = 220;\n  const padding = 35;\n  \n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    \n    ctx.fillStyle = theme.colors.surface;\n    ctx.fillRect(0, 0, size, size);\n    \n    const xVals = points.map(p => p.x);\n    const yVals = points.map(p => p.y);\n    \n    const xMin = Math.min(...xVals) - 0.5;\n    const xMax = Math.max(...xVals) + 0.5;\n    const yMin = Math.min(...yVals, 0) - 0.5;\n    const yMax = Math.max(...yVals) + 1;\n    \n    const scaleX = (x) => padding + ((x - xMin) / (xMax - xMin)) * (size - 2 * padding);\n    const scaleY = (y) => size - padding - ((y - yMin) / (yMax - yMin)) * (size - 2 * padding);\n    \n    // Grid\n    ctx.strokeStyle = theme.colors.border;\n    ctx.lineWidth = 1;\n    for (let i = 0; i <= 4; i++) {\n      const x = padding + (i / 4) * (size - 2 * padding);\n      const y = padding + (i / 4) * (size - 2 * padding);\n      ctx.beginPath();\n      ctx.moveTo(x, padding);\n      ctx.lineTo(x, size - padding);\n      ctx.stroke();\n      ctx.beginPath();\n      ctx.moveTo(padding, y);\n      ctx.lineTo(size - padding, y);\n      ctx.stroke();\n    }\n    \n    // Axes\n    ctx.strokeStyle = theme.colors.textMuted;\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(padding, size - padding);\n    ctx.lineTo(size - padding, size - padding);\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(padding, padding);\n    ctx.lineTo(padding, size - padding);\n    ctx.stroke();\n    \n    // Axis labels\n    ctx.fillStyle = theme.colors.textMuted;\n    ctx.font = '10px JetBrains Mono';\n    ctx.textAlign = 'center';\n    ctx.fillText('x', size / 2, size - 8);\n    ctx.save();\n    ctx.translate(10, size / 2);\n    ctx.rotate(-Math.PI / 2);\n    ctx.fillText('y', 0, 0);\n    ctx.restore();\n    \n    // Show residuals at step 5+\n    if (step >= 5 && theta) {\n      points.forEach((p) => {\n        const predicted = theta[0] + theta[1] * p.x;\n        ctx.strokeStyle = theme.colors.negative;\n        ctx.lineWidth = 2;\n        ctx.setLineDash([4, 4]);\n        ctx.beginPath();\n        ctx.moveTo(scaleX(p.x), scaleY(p.y));\n        ctx.lineTo(scaleX(p.x), scaleY(predicted));\n        ctx.stroke();\n        ctx.setLineDash([]);\n      });\n    }\n    \n    // Regression line at step 6\n    if (step >= 6 && theta) {\n      const x1 = xMin;\n      const x2 = xMax;\n      const y1 = theta[0] + theta[1] * x1;\n      const y2 = theta[0] + theta[1] * x2;\n      \n      ctx.strokeStyle = theme.colors.positive;\n      ctx.lineWidth = 3;\n      ctx.beginPath();\n      ctx.moveTo(scaleX(x1), scaleY(y1));\n      ctx.lineTo(scaleX(x2), scaleY(y2));\n      ctx.stroke();\n    }\n    \n    // Points\n    points.forEach((p, i) => {\n      ctx.fillStyle = step >= 1 ? theme.colors.blue : theme.colors.textMuted;\n      ctx.beginPath();\n      ctx.arc(scaleX(p.x), scaleY(p.y), 7, 0, Math.PI * 2);\n      ctx.fill();\n      ctx.strokeStyle = theme.colors.text;\n      ctx.lineWidth = 2;\n      ctx.stroke();\n    });\n    \n  }, [points, theta, step]);\n  \n  return (\n    <canvas\n      ref={canvasRef}\n      width={size}\n      height={size}\n      style={{ borderRadius: '8px', display: 'block' }}\n    />\n  );\n}\n\n// ============================================\n// Matrix Display Component\n// ============================================\nfunction Matrix({ data, label, color, highlight, small }) {\n  const isVector = !Array.isArray(data[0]);\n  const rows = isVector ? data.map(v => [v]) : data;\n  const cellSize = small ? '24px' : '32px';\n  const fontSize = small ? '10px' : '12px';\n  \n  return (\n    <div style={{ textAlign: 'center' }}>\n      {label && (\n        <div style={{ fontSize: '9px', color: theme.colors.textMuted, marginBottom: '3px' }}>\n          {label}\n        </div>\n      )}\n      <div style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        padding: '4px',\n        background: highlight ? `${color}15` : theme.colors.surface,\n        borderRadius: '6px',\n        border: `2px solid ${highlight ? color : theme.colors.border}`,\n        transition: 'all 0.3s',\n      }}>\n        <span style={{ color: color || theme.colors.textMuted, fontSize: small ? '20px' : '28px', fontWeight: '200' }}>[</span>\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '1px' }}>\n          {rows.map((row, i) => (\n            <div key={i} style={{ display: 'flex', gap: '2px' }}>\n              {row.map((val, j) => (\n                <div\n                  key={j}\n                  style={{\n                    width: cellSize,\n                    height: cellSize,\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    fontSize,\n                    fontWeight: '600',\n                    color: theme.colors.text,\n                  }}\n                >\n                  {typeof val === 'number' ? (Number.isInteger(val) ? val : val.toFixed(2)) : val}\n                </div>\n              ))}\n            </div>\n          ))}\n        </div>\n        <span style={{ color: color || theme.colors.textMuted, fontSize: small ? '20px' : '28px', fontWeight: '200' }}>]</span>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// Main App\n// ============================================\nexport default function RegressionPlayground() {\n  const [exampleIdx, setExampleIdx] = useState(0);\n  const [step, setStep] = useState(0);\n  const [playing, setPlaying] = useState(false);\n  \n  const examples = [\n    {\n      name: 'Simple',\n      X: [[1, 1], [1, 2], [1, 3]],\n      y: [1, 2, 3],\n    },\n    {\n      name: 'With Noise',\n      X: [[1, 1], [1, 2], [1, 3], [1, 4]],\n      y: [1.2, 1.9, 3.1, 4.0],\n    },\n    {\n      name: 'Negative Slope',\n      X: [[1, 1], [1, 2], [1, 3]],\n      y: [3, 2, 1],\n    },\n  ];\n  \n  const ex = examples[exampleIdx];\n  const points = ex.X.map((row, i) => ({ x: row[1], y: ex.y[i] }));\n  const result = useMemo(() => computeRegression(ex.X, ex.y), [exampleIdx]);\n  \n  const totalSteps = 6;\n  \n  const reset = () => { setStep(0); setPlaying(false); };\n  const next = () => step < totalSteps && setStep(step + 1);\n  const prev = () => step > 0 && setStep(step - 1);\n  \n  const auto = async () => {\n    setPlaying(true);\n    for (let s = 0; s <= totalSteps; s++) {\n      setStep(s);\n      await new Promise(r => setTimeout(r, 1400));\n    }\n    setPlaying(false);\n  };\n\n  const stepInfo = [\n    { title: \"The Goal\", desc: \"Find the line that best fits these points. We need two numbers: intercept (where it crosses y-axis) and slope (steepness).\", color: theme.colors.primary },\n    { title: \"Step 1: Input Data\", desc: \"X has our features (with 1s for intercept), y has targets. Each row is one data point.\", color: theme.colors.pink },\n    { title: \"Step 2: Transpose X\", desc: \"Flip X so rows become columns. This lets us combine information across all data points.\", color: theme.colors.orange },\n    { title: \"Step 3: X-transpose times X\", desc: \"This captures how features relate to each other. It's a square matrix we can invert.\", color: theme.colors.yellow },\n    { title: \"Step 4: X-transpose times y\", desc: \"This captures how features relate to the target values we want to predict.\", color: theme.colors.green },\n    { title: \"Step 5: Invert and Solve\", desc: \"Inverting 'undoes' the feature mixing. Multiply by X-transpose-y to get coefficients. Red lines show errors we're minimizing.\", color: theme.colors.blue },\n    { title: \"Result: Best Fit Line\", desc: \"The green line minimizes total squared error. Each point's distance to the line (red) is as small as possible overall.\", color: theme.colors.positive },\n  ];\n\n  return (\n    <div style={{\n      minHeight: '100vh',\n      background: theme.colors.background,\n      color: theme.colors.text,\n      fontFamily: theme.font,\n      padding: '16px',\n    }}>\n      <div style={{ maxWidth: '520px', margin: '0 auto' }}>\n        {/* Header */}\n        <div style={{ textAlign: 'center', marginBottom: '16px' }}>\n          <h1 style={{ fontSize: '18px', fontWeight: '700', margin: 0 }}>Linear Regression</h1>\n          <p style={{ color: theme.colors.textSecondary, fontSize: '11px', marginTop: '4px' }}>\n            Normal Equation: One formula, optimal solution\n          </p>\n        </div>\n        \n        {/* Example Tabs */}\n        <div style={{ display: 'flex', gap: '6px', justifyContent: 'center', marginBottom: '16px' }}>\n          {examples.map((e, idx) => (\n            <button\n              key={idx}\n              onClick={() => { setExampleIdx(idx); reset(); }}\n              style={{\n                padding: '6px 12px',\n                background: exampleIdx === idx ? theme.colors.primary : theme.colors.surface,\n                border: 'none',\n                borderRadius: '6px',\n                color: exampleIdx === idx ? '#fff' : theme.colors.textSecondary,\n                fontFamily: theme.font,\n                fontSize: '11px',\n                cursor: 'pointer',\n              }}\n            >\n              {e.name}\n            </button>\n          ))}\n        </div>\n        \n        {/* Main Card */}\n        <div style={{ background: theme.colors.surfaceAlt, borderRadius: '12px', padding: '16px' }}>\n          \n          {/* Graph + Formula Side by Side */}\n          <div style={{ display: 'flex', gap: '16px', marginBottom: '12px', alignItems: 'flex-start' }}>\n            {/* Graph */}\n            <div>\n              <div style={{ fontSize: '9px', color: theme.colors.textMuted, marginBottom: '4px', textAlign: 'center' }}>\n                GEOMETRIC VIEW\n              </div>\n              <RegressionPlot points={points} theta={result.theta} step={step} />\n            </div>\n            \n            {/* Formula breakdown */}\n            <div style={{ flex: 1 }}>\n              <div style={{ fontSize: '9px', color: theme.colors.textMuted, marginBottom: '4px', textAlign: 'center' }}>\n                ALGEBRAIC VIEW\n              </div>\n              <div style={{\n                padding: '12px',\n                background: theme.colors.surface,\n                borderRadius: '8px',\n                fontSize: '11px',\n                lineHeight: 1.8,\n              }}>\n                <div style={{ marginBottom: '8px', color: theme.colors.textSecondary }}>\n                  The Normal Equation:\n                </div>\n                <div style={{ \n                  display: 'flex', \n                  flexWrap: 'wrap', \n                  gap: '4px', \n                  alignItems: 'center',\n                  fontSize: '12px',\n                }}>\n                  <span style={{ color: theme.colors.positive, fontWeight: '700', opacity: step >= 5 ? 1 : 0.3 }}>theta</span>\n                  <span style={{ color: theme.colors.textMuted }}>=</span>\n                  <span style={{ color: theme.colors.textMuted }}>(</span>\n                  <span style={{ color: theme.colors.orange, fontWeight: '600', opacity: step >= 2 ? 1 : 0.3 }}>X^T</span>\n                  <span style={{ color: theme.colors.pink, fontWeight: '600', opacity: step >= 1 ? 1 : 0.3 }}>X</span>\n                  <span style={{ color: theme.colors.textMuted }}>)</span>\n                  <span style={{ color: theme.colors.yellow, fontWeight: '600', opacity: step >= 3 ? 1 : 0.3 }}>^-1</span>\n                  <span style={{ color: theme.colors.orange, fontWeight: '600', opacity: step >= 2 ? 1 : 0.3 }}>X^T</span>\n                  <span style={{ color: theme.colors.blue, fontWeight: '600', opacity: step >= 1 ? 1 : 0.3 }}>y</span>\n                </div>\n                \n                {/* Step indicator in formula */}\n                <div style={{ marginTop: '12px', fontSize: '10px' }}>\n                  {step === 0 && <span style={{ color: theme.colors.textMuted }}>Click Start to begin...</span>}\n                  {step === 1 && <span style={{ color: theme.colors.pink }}>Inputs: X (features) and y (targets)</span>}\n                  {step === 2 && <span style={{ color: theme.colors.orange }}>Computing X-transpose...</span>}\n                  {step === 3 && <span style={{ color: theme.colors.yellow }}>Computing X^T times X...</span>}\n                  {step === 4 && <span style={{ color: theme.colors.green }}>Computing X^T times y...</span>}\n                  {step === 5 && <span style={{ color: theme.colors.blue }}>Inverting and multiplying...</span>}\n                  {step === 6 && <span style={{ color: theme.colors.positive }}>Done! theta = [{result.theta.join(', ')}]</span>}\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          {/* Step Explanation */}\n          <div style={{\n            padding: '10px 12px',\n            background: theme.colors.surface,\n            borderRadius: '8px',\n            borderLeft: `3px solid ${stepInfo[step].color}`,\n            marginBottom: '12px',\n          }}>\n            <div style={{ fontSize: '12px', fontWeight: '600', color: theme.colors.text, marginBottom: '2px' }}>\n              {stepInfo[step].title}\n            </div>\n            <div style={{ fontSize: '11px', color: theme.colors.textSecondary, lineHeight: 1.4 }}>\n              {stepInfo[step].desc}\n            </div>\n          </div>\n          \n          {/* Step Indicator */}\n          <div style={{ display: 'flex', gap: '4px', justifyContent: 'center', marginBottom: '12px' }}>\n            {Array.from({ length: totalSteps + 1 }).map((_, i) => (\n              <div\n                key={i}\n                onClick={() => setStep(i)}\n                style={{\n                  width: i === step ? '20px' : '8px',\n                  height: '8px',\n                  borderRadius: '4px',\n                  background: i <= step ? theme.colors.primary : theme.colors.border,\n                  cursor: 'pointer',\n                  transition: 'all 0.3s',\n                }}\n              />\n            ))}\n          </div>\n          \n          {/* Controls */}\n          <div style={{ display: 'flex', gap: '8px', alignItems: 'center', marginBottom: '16px' }}>\n            <button onClick={prev} disabled={step <= 0} style={{\n              padding: '10px 14px',\n              background: theme.colors.surface,\n              border: 'none',\n              borderRadius: '8px',\n              color: step <= 0 ? theme.colors.textMuted : theme.colors.text,\n              cursor: step <= 0 ? 'not-allowed' : 'pointer',\n              fontSize: '14px',\n            }}>\n              ←\n            </button>\n            \n            <button onClick={next} disabled={step >= totalSteps} style={{\n              flex: 1,\n              padding: '12px',\n              background: step < totalSteps ? theme.colors.primary : theme.colors.positive,\n              border: 'none',\n              borderRadius: '8px',\n              color: '#fff',\n              fontFamily: theme.font,\n              fontSize: '12px',\n              fontWeight: '600',\n              cursor: step < totalSteps ? 'pointer' : 'default',\n            }}>\n              {step === 0 ? 'Start' : step < totalSteps ? 'Next Step' : 'Complete'}\n            </button>\n            \n            <button onClick={auto} disabled={playing || step >= totalSteps} style={{\n              padding: '10px 14px',\n              background: theme.colors.surface,\n              border: 'none',\n              borderRadius: '8px',\n              color: playing || step >= totalSteps ? theme.colors.textMuted : theme.colors.text,\n              cursor: playing || step >= totalSteps ? 'not-allowed' : 'pointer',\n              fontSize: '12px',\n            }}>\n              ▶▶\n            </button>\n            \n            <button onClick={reset} style={{\n              padding: '10px 14px',\n              background: theme.colors.surface,\n              border: 'none',\n              borderRadius: '8px',\n              color: theme.colors.text,\n              cursor: 'pointer',\n              fontSize: '14px',\n            }}>\n              ↺\n            </button>\n          </div>\n          \n          {/* ============ MATH DETAILS BELOW CONTROLS ============ */}\n          \n          {/* Matrix Operations */}\n          {step >= 1 && (\n            <div style={{\n              padding: '12px',\n              background: theme.colors.surface,\n              borderRadius: '8px',\n              marginBottom: '12px',\n            }}>\n              {step === 1 && (\n                <div style={{ display: 'flex', gap: '20px', justifyContent: 'center', alignItems: 'flex-start' }}>\n                  <Matrix data={ex.X} label=\"X (features)\" color={theme.colors.pink} highlight />\n                  <Matrix data={ex.y} label=\"y (targets)\" color={theme.colors.blue} highlight />\n                </div>\n              )}\n              \n              {step === 2 && (\n                <div style={{ display: 'flex', gap: '12px', justifyContent: 'center', alignItems: 'center', flexWrap: 'wrap' }}>\n                  <Matrix data={ex.X} label=\"X\" color={theme.colors.pink} small />\n                  <span style={{ color: theme.colors.textMuted, fontSize: '16px' }}>transpose</span>\n                  <span style={{ color: theme.colors.textMuted, fontSize: '20px' }}>→</span>\n                  <Matrix data={result.Xt} label=\"X-transpose\" color={theme.colors.orange} highlight />\n                </div>\n              )}\n              \n              {step === 3 && (\n                <div style={{ display: 'flex', gap: '10px', justifyContent: 'center', alignItems: 'center', flexWrap: 'wrap' }}>\n                  <Matrix data={result.Xt} color={theme.colors.orange} small />\n                  <span style={{ color: theme.colors.textMuted }}>x</span>\n                  <Matrix data={ex.X} color={theme.colors.pink} small />\n                  <span style={{ color: theme.colors.textMuted }}>=</span>\n                  <Matrix data={result.XtX} label=\"X^T X\" color={theme.colors.yellow} highlight />\n                </div>\n              )}\n              \n              {step === 4 && (\n                <div style={{ display: 'flex', gap: '10px', justifyContent: 'center', alignItems: 'center', flexWrap: 'wrap' }}>\n                  <Matrix data={result.Xt} color={theme.colors.orange} small />\n                  <span style={{ color: theme.colors.textMuted }}>x</span>\n                  <Matrix data={ex.y} color={theme.colors.blue} small />\n                  <span style={{ color: theme.colors.textMuted }}>=</span>\n                  <Matrix data={result.Xty.map(v => Math.round(v * 10) / 10)} label=\"X^T y\" color={theme.colors.green} highlight />\n                </div>\n              )}\n              \n              {step >= 5 && (\n                <div>\n                  <div style={{ display: 'flex', gap: '10px', justifyContent: 'center', alignItems: 'center', flexWrap: 'wrap', marginBottom: '12px' }}>\n                    <Matrix data={result.XtXinv.map(row => row.map(v => Math.round(v * 100) / 100))} label=\"(X^T X)^-1\" color={theme.colors.primary} small />\n                    <span style={{ color: theme.colors.textMuted }}>x</span>\n                    <Matrix data={result.Xty.map(v => Math.round(v * 10) / 10)} color={theme.colors.green} small />\n                    <span style={{ color: theme.colors.textMuted }}>=</span>\n                    <Matrix data={result.theta} label=\"theta\" color={theme.colors.positive} highlight />\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n          \n          {/* Final Result */}\n          {step >= 6 && (\n            <div style={{\n              padding: '14px',\n              background: `${theme.colors.positive}15`,\n              borderRadius: '8px',\n              border: `1px solid ${theme.colors.positive}`,\n              textAlign: 'center',\n            }}>\n              <div style={{ fontSize: '10px', color: theme.colors.textMuted, marginBottom: '6px' }}>\n                BEST FIT LINE\n              </div>\n              <div style={{ fontSize: '20px', marginBottom: '8px' }}>\n                <span style={{ color: theme.colors.text }}>y = </span>\n                <span style={{ color: theme.colors.pink, fontWeight: '700' }}>{result.theta[0]}</span>\n                <span style={{ color: theme.colors.text }}> + </span>\n                <span style={{ color: theme.colors.blue, fontWeight: '700' }}>{result.theta[1]}</span>\n                <span style={{ color: theme.colors.text }}>x</span>\n              </div>\n              <div style={{ display: 'flex', gap: '24px', justifyContent: 'center', fontSize: '11px' }}>\n                <div>\n                  <span style={{ color: theme.colors.textMuted }}>Intercept: </span>\n                  <span style={{ color: theme.colors.pink, fontWeight: '600' }}>{result.theta[0]}</span>\n                </div>\n                <div>\n                  <span style={{ color: theme.colors.textMuted }}>Slope: </span>\n                  <span style={{ color: theme.colors.blue, fontWeight: '600' }}>{result.theta[1]}</span>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n        \n        {/* Key Insight */}\n        <div style={{\n          marginTop: '12px',\n          padding: '10px 14px',\n          background: theme.colors.surface,\n          borderRadius: '8px',\n          fontSize: '10px',\n          color: theme.colors.textSecondary,\n          textAlign: 'center',\n        }}>\n          <strong style={{ color: theme.colors.text }}>Two views, one solution:</strong> Geometrically, we minimize distances to the line. \n          Algebraically, matrix operations give us the exact answer in one step.\n        </div>\n      </div>\n    </div>\n  );\n}",
  "settings": {
    "editorHeight": 600,
    "showPreview": true,
    "theme": "auto",
    "showEditor": false,
    "editorWidthPercentage": 35,
    "showConsole": false
  },
  "dependencies": {}
}